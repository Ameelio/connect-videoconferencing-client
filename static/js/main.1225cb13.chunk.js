(this["webpackJsonpconnect-client"]=this["webpackJsonpconnect-client"]||[]).push([[0],{1191:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(46),l=a.n(c),i=a(12),o=a.n(i),s=a(23),u=a(19),d=(a(558),a(114)),m=a(47),f=a(1198),p=a(1216),h=a(182),b=a(1214),E=a(1207),v=a(1205),y=a(1211),g=a(79);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function j(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var w,C=r.a.createElement("defs",null,r.a.createElement("style",null,".cls-1,.cls-2{fill:#0073eb;stroke:#fff;stroke-miterlimit:10;stroke-width:3px;}.cls-2{opacity:0.7;}.cls-3{fill:#1a1a1a;}")),k=r.a.createElement("path",{className:"cls-1",d:"M111.83,48.88h0l-8.38,20.22L98.27,81.58l0,0v.08L91.48,98h0L90,101.55h0l-2.9,7-.6-2.23-.64-2.43-4-15.27L71,47.66l-1.6-6.1L63.79,20.1Z"}),S=r.a.createElement("polygon",{className:"cls-2",points:"87.09 108.56 85.99 107.12 84.4 105.05 77.65 96.2 71.96 88.74 50.31 60.32 41.21 48.39 71.04 47.66 81.83 88.63 85.85 103.9 86.49 106.33 87.09 108.56"}),x=r.a.createElement("polygon",{className:"cls-1",points:"67.95 154.72 59.71 174.61 29.58 171.5 58.55 149.76 64.48 145.32 75.17 137.31 67.96 154.69 67.95 154.72"}),I=r.a.createElement("path",{className:"cls-1",d:"M134.41,137.69h0L81.75,151.16l-2.83.73-11,2.8,7.21-17.38h0l2.27-5.48h0l9.54-23,.1-.23h0l2.9-7h0L91.47,98h0l6.75-16.29h0l0-.09,5.17-12.47,8.38-20.22h0l4,15.53,4.51,17.78,4.95,19.43,3,11.89h0Z"}),T=r.a.createElement("polygon",{className:"cls-1",points:"161.52 72.3 156.34 84.79 151.4 96.73 147.81 105.36 146.74 107.93 146.74 107.94 134.41 137.69 128.27 113.52 128.26 113.52 125.24 101.63 120.29 82.2 120.3 82.19 121.87 81.82 141.5 77.1 160.2 72.62 161.52 72.3"}),D=r.a.createElement("polygon",{className:"cls-2",points:"187.8 89.91 179.44 91.47 170.42 93.17 170.41 93.16 151.4 96.73 156.34 84.79 161.52 72.3 162.14 72.71 187.8 89.91"}),N=r.a.createElement("path",{className:"cls-3",d:"M234.77,211.91h-17.2L209.18,190H163l-8.4,21.88H137.37l38.93-98.23h19.54Zm-66-36.73H203.4l-17.33-45.27Z"}),M=r.a.createElement("path",{className:"cls-3",d:"M259.67,211.91H245V161.28h-5.64V148.07h11.83l6.19,6.2c5.5-4.54,12.24-7.43,18.57-7.43a20.61,20.61,0,0,1,17.34,8.66,31.53,31.53,0,0,1,21-8.66c11.7,0,22.43,8,22.43,26.55v38.52H322V173.39c0-8.39-4.54-12.93-11.28-12.93-7.57,0-12.52,4.54-12.52,10.59v40.86H283.61V173.39c0-8.39-4.68-12.93-11.29-12.93-7.42,0-12.65,4.4-12.65,10.18Z"}),P=r.a.createElement("path",{className:"cls-3",d:"M393.53,190.72l12.1,6.61c-4.95,8.39-14.17,16.09-26.82,16.09-18.3,0-31.37-15.41-31.37-33.29s13.07-33.57,31.23-33.57,29.44,15.27,30,31.92l-5.5,5.36H362.3c.82,9.5,8.11,15.82,16.51,15.82C384.58,199.66,390.36,196,393.53,190.72ZM363,172.15h30.95c-1-7.15-7.43-12.52-15.27-12.52A15.72,15.72,0,0,0,363,172.15Z"}),A=r.a.createElement("path",{className:"cls-3",d:"M461.76,190.72l12.11,6.61c-4.95,8.39-14.17,16.09-26.83,16.09-18.3,0-31.37-15.41-31.37-33.29s13.07-33.57,31.23-33.57,29.44,15.27,30,31.92l-5.5,5.36H430.53c.83,9.5,8.12,15.82,16.51,15.82C452.82,199.66,458.6,196,461.76,190.72Zm-30.54-18.57h30.95c-1-7.15-7.42-12.52-15.27-12.52A15.72,15.72,0,0,0,431.22,172.15Z"}),H=r.a.createElement("path",{className:"cls-3",d:"M489.41,113.68l4.82-5h10.18V197.6h5.64v14.31H495.6l-6.19-6.33Z"}),L=r.a.createElement("path",{className:"cls-3",d:"M540.73,211.91H526V161.28h-5.5V148.07h15l5.23,5.23ZM532,112a10.49,10.49,0,0,1,10.39,10.39A10.37,10.37,0,0,1,532,132.67a10.25,10.25,0,0,1-10.25-10.26A10.37,10.37,0,0,1,532,112Z"}),V=r.a.createElement("path",{className:"cls-3",d:"M620,180a33.36,33.36,0,1,1-33.29-33.29A33.35,33.35,0,0,1,620,180Zm-15,0c0-10.32-7.71-19.12-18.3-19.12s-18.44,8.8-18.44,19.12,7.85,19.26,18.44,19.26S605,190.31,605,180Z"}),B=function(e){var t=e.svgRef,a=e.title,n=j(e,["svgRef","title"]);return r.a.createElement("svg",O({id:"Golden_Grid","data-name":"Golden Grid",viewBox:"0 0 666.85 257.93",ref:t},n),a?r.a.createElement("title",null,a):null,C,k,S,x,I,T,D,N,M,P,A,H,L,V)},F=r.a.forwardRef((function(e,t){return r.a.createElement(B,O({svgRef:t},e))})),R=(a.p,a(563),a(16)),q=a(76),Z=a(36),z=Object(Z.c)(),W=Object(Z.b)("staff/fetchStaff",Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("staffMembers");case 2:return t=e.sent,a=t.data.results,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))),U=Object(Z.b)("staff/updateStaff",function(){var e=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("/admin",{method:"POST",body:JSON.stringify({user_id:t.userId,permissions:t.permissions})});case 2:if(200===e.sent.status){e.next=5;break}throw new Error("Failed to update staff member information");case 5:return e.abrupt("return",{userId:t.userId,changes:{permissions:t.permissions}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_=Object(Z.b)("staff/createStaff",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("/admin",{method:"POST",body:JSON.stringify({email:t.email,role:t.role,permissions:t.permissions})});case 2:return a=e.sent,n=a.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G=z.getInitialState({loading:!1}),J=Object(Z.d)({name:"staff",initialState:G,reducers:{staffSetAll:z.setAll,staffUpdateOne:z.updateOne},extraReducers:function(e){e.addCase(W.fulfilled,(function(e,t){return z.addMany(e,t.payload)})),e.addCase(W.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message})})),e.addCase(U.fulfilled,(function(e,t){return z.updateOne(e,{id:t.payload.userId,changes:t.payload.changes})})),e.addCase(U.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message})})),e.addCase(_.fulfilled,(function(e,t){return z.addOne(e,t.payload)})),e.addCase(_.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message})}))}}),K=(J.actions,Object(Z.b)("inmates/fetchInmates",Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("inmates");case 2:return t=e.sent,a=t.data.results,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)}))))),Y=Object(Z.c)(),Q=Object(Z.d)({name:"inmates",initialState:Y.getInitialState(),reducers:{inmatesAddMany:Y.addMany,inmatesUpdate:Y.updateOne},extraReducers:function(e){e.addCase(K.fulfilled,(function(e,t){return Y.setAll(e,t.payload)})),e.addCase(K.rejected,(function(e,t){return console.log("error")}))}});Q.actions;!function(e){e[e.Sunday=0]="Sunday",e[e.Monday=1]="Monday",e[e.Tuesday=2]="Tuesday",e[e.Wednesday=3]="Wednesday",e[e.Thursday=4]="Thursday",e[e.Friday=5]="Friday",e[e.Saturday=6]="Saturday"}(w||(w={}));var $=[w.Sunday,w.Monday,w.Tuesday,w.Wednesday,w.Thursday,w.Friday,w.Saturday],X={1:24,2:12,4:12,6:8,8:6},ee={1:80,2:80,4:40,6:40,8:40},te=[{id:0,title:"Unallowed visitor",body:"All participants on the call must have  been registered and pre-approved ahead of time. The presence of unallowed visitors may lead to call termination."},{id:1,title:"Appropriate clothing",body:"All adult and minor visitors, including attorneys, must be fully dressed in appopriate, conventional clothing which is not unduly provocative, suggestive, or revealing and does not resemble offender attire or present adornments which could be used as a weapon."},{id:2,title:"Clothing exposure",body:"Any clothing worn on the top half of the body must have sleeves and not expose the cleavage line, back, midriff and/or underarm at any time while standing, sitting, and/or bending down."},{id:3,title:"Appropriate undergarments",body:"Appropriate undergarments are required, and will not be visible."},{id:4,title:"No sheer clothing",body:"Clothing which is sheer or transparent will not be permitted. Clothing that contains holes and/or rips will not be permitted."},{id:5,title:"Clothing no shorter than knee",body:"Outer garments worn on the bottom half of the body must be no shorter than the knee while standing."},{id:6,title:"Leggings no shorter than knee",body:"Leggings and jeggings may only be worn under outer garments that must be no shorter than the knee while standing."}],ae=function(e){return{type:"user/SET_SESSION",payload:e}},ne=function(e){return{type:"user/SET_SESSION_STATUS",payload:e}},re={user:{id:-999,firstName:"",lastName:"",email:"",staffPositions:[]},authInfo:{id:-999,type:"doc",token:""},status:"inactive",redirectUrl:"/"};function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"user/SET_SESSION":var a=t.payload,n=a.user,r=a.token;return Object(R.a)(Object(R.a)({},e),{},{user:n,authInfo:{token:r,type:"doc",id:n.id},status:"active"});case"user/LOGOUT":return Object(R.a)(Object(R.a)({},e),{},{user:{id:-999,firstName:"",lastName:"",email:"",staffPositions:[]},status:"inactive",redirectUrl:"/"});case"user/SET_REDIRECT_URL":return Object(R.a)(Object(R.a)({},e),{},{redirectUrl:t.payload});case"user/SET_SESSION_STATUS":return Object(R.a)(Object(R.a)({},e),{},{status:t.payload});default:return e}}var le=a(129),ie=a(492),oe=a(93),se=a(234),ue=a(1195),de=a(1196),me=a(1197),fe=a(331),pe=a(166),he=a.n(pe),be=a(262),Ee=(a(1193),a(1194),function(e){return e?"".concat(e.firstName," ").concat(e.lastName):""});function ve(e,t,a){return a.indexOf(e)===t}var ye=function(e){for(var t=[],a=0,n=Object.keys(e);a<n.length;a++){var r,c=n[a];if("scheduledStart"===c)(null===(r=e.scheduledStart)||void 0===r?void 0:r.rangeStart)&&e.scheduledStart.rangeEnd&&t.push([c,"".concat(e.scheduledStart.rangeStart,",").concat(e.scheduledStart.rangeEnd)]);else e[c]&&t.push([c,"".concat(e[c])])}return function(e){return e.map((function(e){return e[0]+"="+encodeURIComponent(e[1])})).join("&")}(t)};function ge(e){var t=["#093145","#3C6478","#107896","#43ABC9","#C2571A","#9A2617"];return t[Math.abs(function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<6)-t);return t}(e)%t.length)]}function Oe(e){return null!==e&&void 0!==e}var je=function(e,t,a){var n=e.reduce((function(e,a){var n=t(a);return e[n]||(e[n]=[]),e[n].push(a),e}),{});return a&&a.forEach((function(e){n[e]||(n[e]=[])})),n};function we(e,t){return t.toLowerCase().includes(e.toLowerCase())}var Ce=function(e){var t=new Date;return t.setHours(e.hour),t.setMinutes(e.minute),t.toString()},ke=function(e){var t=new Date;return t.setHours(e.hour),t.setMinutes(e.minute),Object(se.a)(t,e.duration).toString()};function Se(e){var t=e.getDay();return e.setDate(e.getDate()-t+1),e.setHours(0,0,0,0),e}var xe=function(e,t,a){return e.filter((function(e){return new Date(e.scheduledEnd)>=t&&new Date(e.scheduledEnd)<=a}))},Ie=function(e){var t=new Date;t.setHours(0,0,0,0);var a=new Date;return a.setHours(23,59,59,59),xe(e,t,a)};function Te(e,t,a,n){return e.map((function(e){return function(e,t,a,n){var r=e.userIds.map((function(e){return t[e]})).filter(Oe);r.length,e.userIds.length;var c=e.inmateIds.map((function(e){return a[e]})).filter(Oe);c.length,e.inmateIds.length;var l=n[e.kioskId];return Object(R.a)(Object(R.a)({},e),{},{contacts:r,inmates:c,kiosk:l||{id:-1,name:"Failed to load information",description:"Failed to load information",enabled:!0}})}(e,t,a,n)}))}function De(e){return e.inmates.map((function(e){return"".concat(e.firstName," ").concat(e.lastName)})).join(", ")}function Ne(e){return e.contacts.map((function(e){return"".concat(e.firstName," ").concat(e.lastName)})).join(", ")}var Me=a(545),Pe=a(546),Ae=function(e,t,a){Me.a[a]({message:e,description:t})},He=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;switch(a){case"success":Pe.b.success({content:t,key:e,duration:n});break;case"error":Pe.b.error({content:t,key:e,duration:n});break;case"warning":Pe.b.warning({content:t,key:e,duration:n});break;case"loading":Pe.b.loading({content:t,key:e,duration:n});break;default:Pe.b.info({content:t,key:e,duration:n})}};function Le(e,t,a){return e.map((function(e){return function(e,t,a){var n=t[e.userId];if(!n)throw new Error("Failed to load contact information");var r=a[e.inmateId];if(!r)throw new Error("Failed to load incarcerated person information");return Object(R.a)(Object(R.a)({},e),{},{inmate:r,contact:n})}(e,t,a)}))}var Ve=Object(Z.b)("connections/updateConnection",function(){var e=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("connections/".concat(t.connectionId),{method:"PUT",body:JSON.stringify({status:t.status})});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Be=Object(Z.b)("connections/fetchConnections",Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("connections");case 2:return t=e.sent,a=t.data.results,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))),Fe=Object(Z.c)(),Re=Object(Z.d)({name:"connections",initialState:Fe.getInitialState(),reducers:{connectionsAddOne:Fe.addOne,connectionsAddMany:Fe.addMany,connectionsUpdate:Fe.updateOne},extraReducers:function(e){e.addCase(Be.fulfilled,(function(e,t){return Fe.addMany(e,t.payload)})),e.addCase(Be.rejected,(function(e,t){return console.log(t.error)})),e.addCase(Ve.fulfilled,(function(e,t){var a=t.payload,n=a.status,r=a.connectionId;switch(n){case"active":Ae("Connection was successfully approved.","Both parties were notified of the decision.","success");break;case"rejected":Ae("Connection request was rejected.","Both parties were notified of the decision.","info")}Fe.updateOne(e,{id:r,changes:{status:n}})})),e.addCase(Ve.rejected,(function(e,t){return console.log(t.error)}))}}),qe=(Re.actions,Object(Z.b)("contact/fetchContacts",Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("contacts");case 2:return t=e.sent,a=t.data.results,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)}))))),Ze=Object(Z.c)(),ze=Object(Z.d)({name:"inmates",initialState:Ze.getInitialState(),reducers:{contactsAddMany:Ze.addMany},extraReducers:function(e){e.addCase(qe.fulfilled,(function(e,t){return Ze.setAll(e,t.payload)})),e.addCase(qe.rejected,(function(e,t){return console.log("error")}))}});ze.actions;function We(e){var t=e.videoHandler;return{id:e.id,facilityId:e.facilityId,kioskId:e.kioskId,status:e.status,statusDetails:e.statusDetails,scheduledStart:new Date(e.scheduledStart).toISOString(),scheduledEnd:new Date(e.scheduledEnd).toISOString(),inmateIds:e.inmateIds,userIds:e.userIds,rating:e.rating,schedulerId:e.schedulerId,schedulerType:e.schedulerType,messages:e.messages||[],videoHandler:t?{host:t.host,port:t.port}:void 0}}var Ue,_e=Object(Z.c)(),Ge=Object(Z.b)("calls/fetchAll",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("calls?".concat(ye(t)));case 2:return a=e.sent,n=a.data.results.map(We),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Je=Object(Z.b)("calls/updateCallStatus",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,n=t.status,r=t.statusDetails,e.next=3,St("calls/".concat(a),{method:"PATCH",body:JSON.stringify({status:n,statusDetails:r})});case 3:return e.abrupt("return",{id:a,changes:{status:n,statusDetails:r}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ke=Object(Z.b)("calls/fetchOne",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("calls/".concat(t,"/callMessages"));case 2:return a=e.sent,n=a.data,e.abrupt("return",{id:t,changes:{messages:n}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ye=_e.getInitialState({}),Qe=Object(Z.d)({name:"calls",initialState:Ye,reducers:{callsAddMany:_e.addMany,callsSetAll:_e.setAll,addMessage:function(e,t){var a=t.payload,n=a.id,r=a.message,c=_e.getSelectors().selectById(e,n);c&&_e.updateOne(e,{id:n,changes:{messages:[].concat(Object(le.a)(c.messages),[r])}})}},extraReducers:function(e){e.addCase(Ge.fulfilled,(function(e,t){_e.upsertMany(e,t.payload),e.error=void 0})),e.addCase(Ge.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message})})),e.addCase(Ke.fulfilled,(function(e,t){return _e.updateOne(e,t.payload)})),e.addCase(Je.fulfilled,(function(e,t){switch(_e.updateOne(e,t.payload),t.payload.changes.status){case"cancelled":Ae("Call was rejected","Both parties were notified of the decision.","success");break;case"scheduled":Ae("Call request was reject","Both parties were notified of the decision.","info")}}))}}),$e=Qe.actions,Xe=Object(Z.c)(),et=Object(Z.b)("facility/selectActiveFacility",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("facilities/".concat(t.id,"/callSlots"),{},!1);case 2:return a=e.sent,n=a.data.results,e.abrupt("return",Object(R.a)(Object(R.a)({},t),{},{callTimes:n}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),tt=Object(Z.b)("facility/fetchFacilities",Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("users/".concat(Ot.getState().session.user.id,"/facilities"),{},!1);case 2:if(t=e.sent,(a=t.data).length){e.next=6;break}throw new Error("Must have access to at least one facility");case 6:return Ot.dispatch(et(a[0])),e.abrupt("return",{facilities:a});case 8:case"end":return e.stop()}}),e)})))),at=Object(Z.b)("facility/updateCallTimes",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.oldCallSlots,n=t.newCallSlots,!a.length){e.next=4;break}return e.next=4,St("callSlots/bulk?id=".concat(a.map((function(e){return e.id})).join(",")),{method:"DELETE"});case 4:return e.next=6,St("callSlots",{method:"POST",body:JSON.stringify(n)});case 6:return r=e.sent,e.abrupt("return",r.data);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),nt=Xe.getInitialState({loading:!1}),rt=Object(Z.d)({name:"facilities",initialState:nt,reducers:{},extraReducers:function(e){e.addCase(tt.fulfilled,(function(e,t){return Xe.setAll(e,t.payload.facilities)})),e.addCase(tt.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message})})),e.addCase(et.fulfilled,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{selected:t.payload,loading:!1})})),e.addCase(et.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message,loading:!1})})),e.addCase(et.pending,(function(e){return Object(R.a)(Object(R.a)({},e),{},{loading:!0})})),e.addCase(at.pending,(function(e,t){He("facility/updateCallTimes","Processing request...","loading")})),e.addCase(at.fulfilled,(function(e,t){return He("facility/updateCallTimes","Succesfully updated the settings!","success"),e.selected?Object(R.a)(Object(R.a)({},e),{},{selected:Object(R.a)(Object(R.a)({},e.selected),{},{callTimes:t.payload})}):Object(R.a)({},e)})),e.addCase(at.rejected,(function(e,t){He("facility/updateCallTimes","Failed to update.","success")}))}}),ct=(rt.actions,a(111)),lt=a(344),it=a(119),ot=Object(Z.d)({name:"socket",initialState:{},reducers:{setSocket:function(e,t){return Object(R.a)(Object(R.a)({},e),{},{socket:t.payload})}}}),st=(ot.actions,function e(t){var a=t.id,n=t.name,r=t.children;return{title:n,key:a,children:r.length?r.map((function(t){return e(t)})):[]}}),ut=Object(Z.b)("node/fetchGroups",Object(s.a)(o.a.mark((function e(){var t,a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("groups");case 2:return t=e.sent,a=t.data,n=a.map((function(e){return st(e)})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))),dt=Object(Z.d)({name:"groups",initialState:{nodes:[]},reducers:{},extraReducers:function(e){e.addCase(ut.fulfilled,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{nodes:t.payload})})),e.addCase(ut.rejected,(function(e,t){return He("nodes","Could not load facility information","error")}))}}),mt=Object(Z.c)(),ft=Object(Z.b)("kiosk/fetchKiosks",Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St("kiosks");case 2:return t=e.sent,a=t.data.results,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))),pt=Object(Z.d)({name:"kiosks",initialState:mt.getInitialState(),reducers:{setSelected:function(e,t){return Object(R.a)(Object(R.a)({},e),{},{selected:t.payload})}},extraReducers:function(e){e.addCase(ft.fulfilled,(function(e,t){return mt.setAll(e,t.payload)})),e.addCase(ft.rejected,(function(e,t){return Object(R.a)(Object(R.a)({},e),{},{error:t.error.message})}))}}),ht=Object(Z.d)({name:"modals",initialState:{data:{activeType:"INACTIVE_MODAL",entity:null}},reducers:{openModal:function(e,t){e.data=t.payload},closeModal:function(e){e.data={activeType:"INACTIVE_MODAL",entity:null}}}}),bt=ht.actions,Et=bt.openModal,vt=bt.closeModal,yt=Object(it.a)(),gt=(Ue=yt,Object(q.c)({staff:J.reducer,session:ce,inmates:Q.reducer,contacts:ze.reducer,connections:Re.reducer,calls:Qe.reducer,facilities:rt.reducer,router:Object(ct.b)(Ue),sockets:ot.reducer,groups:dt.reducer,kiosks:pt.reducer,modals:ht.reducer})),Ot=Object(Z.a)({reducer:gt,middleware:function(e){return e().concat(Object(lt.a)(yt))}}),jt=function(){return Object(m.d)()},wt=m.e,Ct="https://capin-staging.ameelio.org/api/v1/";function kt(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;return Promise.race([fetch(e,Object(R.a)(Object(R.a)({},t),{},{mode:"cors"})),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),a)}))])}function St(e){return xt.apply(this,arguments)}function xt(){return(xt=Object(s.a)(o.a.mark((function e(t){var a,n,r,c,l,i,s,u,d,m=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.length>1&&void 0!==m[1]?m[1]:{},r=!(m.length>2&&void 0!==m[2])||m[2],c=m.length>3&&void 0!==m[3]?m[3]:15e3,l=Ot.getState(),i=Object(R.a)(Object(R.a)({},n),{},{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:l.session.authInfo.token},credentials:"include"}),s="".concat(Ct).concat(r?"facilities/".concat(null===(a=l.facilities.selected)||void 0===a?void 0:a.id,"/"):"").concat(t),e.next=8,kt(s,i,c);case 8:if(400!==(u=e.sent).status&&403!==u.status||He("fetchAuthenticated","You are not allowed to perform this action. Contact the admin.","error"),200===u.status||201===u.status){e.next=12;break}throw new Error("Failed to access resource ".concat(t));case 12:return e.next=14,u.json();case 14:return d=e.sent,e.abrupt("return",d);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var It=a(494),Tt=a.n(It);function Dt(e,t){return Nt.apply(this,arguments)}function Nt(){return(Nt=Object(s.a)(o.a.mark((function e(t,a){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.data,Ot.dispatch(ae({user:n,token:t}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mt(e){return Pt.apply(this,arguments)}function Pt(){return(Pt=Object(s.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ot.dispatch(ne("loading")),e.next=3,kt(Tt.a.resolve(Ct,"auth/login"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t.email,password:t.password})});case 3:return a=e.sent,e.next=6,a.json();case 6:if(n=e.sent,201===a.status){e.next=10;break}throw Ot.dispatch(ne("inactive")),a;case 10:if(r=a.headers.get("Authorization")||""){e.next=13;break}throw new Error("Cannot find header token");case 13:return e.next=15,Dt(r,n);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var At=a(1217),Ht=a(1218),Lt=f.a.Content,Vt=Object(m.c)((function(e){return{session:e.session}}));var Bt=Vt((function(e){var t=e.session;if("active"===t.status)return He("login","Welcome back, ".concat(t.user.firstName,"!"),"success"),r.a.createElement(d.a,{to:t.redirectUrl});var a=function(){var e=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return He("login","Authenticating with credentials...","loading"),e.prev=1,e.next=4,Mt({email:t.email,password:t.password});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),He("login","Invalid email or password","error");case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(Lt,{className:"d-flex flex-column"},r.a.createElement(p.b,{direction:"vertical",className:"m-auto"},r.a.createElement(h.a,{justify:"center"},r.a.createElement(F,{className:"login-logo"})),r.a.createElement(b.a,{className:"login-form-container"},r.a.createElement(h.a,{justify:"center"},r.a.createElement(E.a.Title,{level:3},"Welcome!")),r.a.createElement(v.a,{name:"basic",onFinish:a,onFinishFailed:function(e){He("login","Invalid email or password","error")},className:"login-form"},r.a.createElement(v.a.Item,{name:"email",rules:[{required:!0,message:"Email is required."}]},r.a.createElement(y.a,{prefix:r.a.createElement(At.a,{className:"site-form-item-icon"}),placeholder:"Email"})),r.a.createElement(v.a.Item,{name:"password",rules:[{required:!0,message:"Password is required."}]},r.a.createElement(y.a.Password,{prefix:r.a.createElement(Ht.a,{className:"site-form-item-icon"}),placeholder:"Password"})),r.a.createElement(v.a.Item,null,r.a.createElement(g.a,{type:"primary",htmlType:"submit",size:"large",block:!0,loading:"loading"===t.status},"Log In"))))))})),Ft=function(e){var t="";if(e.isAuthenticated||(t=e.authenticationPath),t){return n.createElement(d.b,Object.assign({},e,{component:function(){return n.createElement(d.a,{to:{pathname:t}})},render:void 0}))}return n.createElement(d.b,e)},Rt=a(115),qt=a(254),Zt=a(1212),zt=a(1219),Wt=a(1220),Ut=a(1221),_t=a(1222),Gt=a(1223),Jt=a(1224),Kt=(a(699),a(548)),Yt=a(543),Qt=function(e){var t=e.name,a=Object(Kt.a)(e,["name"]);return r.a.createElement(Yt.a,Object.assign({style:{backgroundColor:ge(t)}},a),t.split(" ").map((function(e){return e[0]})).join(""))},$t=a(1204),Xt=function(e){var t=e.fallback,a=e.size,n=e.src;return n?r.a.createElement($t.a,{src:n,width:a||200}):r.a.createElement(Qt,{name:t,size:a||"default",shape:"square"})},ea=f.a.Sider,ta=Rt.a.SubMenu;function aa(e){var t=e.isLoggedIn,a=e.user,c=e.selected,l=e.facilities,i=e.select,o=e.logout,s=e.requestsCount,m=e.liveCallsCount,f=e.callRequestsCount,h=Object(n.useState)(!1),b=Object(u.a)(h,2),E=b[0],v=b[1],y=Object(d.f)();if(!t)return r.a.createElement("div",null);var g=r.a.createElement(Rt.a,null,r.a.createElement(ta,{key:"sub2",title:"Switch Organization"},l.map((function(e){return r.a.createElement(Rt.a.Item,{key:e.id,onClick:function(){return i(e)}},r.a.createElement(p.b,null,r.a.createElement(Xt,{fallback:c.name,size:48}),r.a.createElement("span",null,e.name)))}))),r.a.createElement(Rt.a.Item,null,r.a.createElement("span",{onClick:function(){return o()}},"Log out")));return r.a.createElement(ea,{collapsible:!0,collapsed:E,onCollapse:function(e){return v(e)},width:300},r.a.createElement(qt.a,{overlay:g},r.a.createElement(p.b,{align:"center",className:"menu-header"},r.a.createElement(Xt,{fallback:c.name,size:48}),!E&&r.a.createElement(p.b,{direction:"vertical",size:0},r.a.createElement(p.b,{align:"center"},r.a.createElement("span",{className:"menu-header-facility"},c.name),r.a.createElement(zt.a,{style:{color:"white"}})),r.a.createElement("span",{className:"menu-header-name"},Ee(a))))),r.a.createElement(Rt.a,{theme:"dark",defaultSelectedKeys:["dash"]},r.a.createElement(Rt.a.Item,{key:"dash",icon:r.a.createElement(Wt.a,null),onClick:function(){return y.push("/")}},"Dashboard"),r.a.createElement(Rt.a.Item,{key:"live",icon:r.a.createElement(Ut.a,null),onClick:function(){return y.push("/visitations")}},"Live Video Calls",r.a.createElement(Zt.a,{count:m})),r.a.createElement(Rt.a.Item,{key:"connection-requests",icon:r.a.createElement(_t.a,null),onClick:function(){return y.push("/connection-requests")}},"Visitation List Requests",r.a.createElement(Zt.a,{count:s})),r.a.createElement(Rt.a.Item,{key:"call-requests",icon:r.a.createElement(_t.a,null),onClick:function(){return y.push("/call-requests")}},"Scheduling Requests",r.a.createElement(Zt.a,{count:f})),r.a.createElement(Rt.a.Item,{key:"search",icon:r.a.createElement(_t.a,null),onClick:function(){return y.push("/logs")}},"Search for Visits"),r.a.createElement(Rt.a.Item,{key:"staff",icon:r.a.createElement(Gt.a,null),onClick:function(){return y.push("/staff")}},"Staff"),r.a.createElement(Rt.a.Item,{key:"members",icon:r.a.createElement(Gt.a,null),onClick:function(){return y.push("/members")}},"Incarcerated People"),r.a.createElement(Rt.a.Item,{key:"settings",icon:r.a.createElement(Jt.a,null),onClick:function(){return y.push("/settings")}},"Settings")))}var na=a(513),ra=Fe.getSelectors((function(e){return e.connections})),ca=(ra.selectById,ra.selectAll),la=Y.getSelectors((function(e){return e.inmates})),ia=la.selectById,oa=la.selectAll,sa=la.selectTotal,ua=la.selectEntities,da=Ze.getSelectors((function(e){return e.contacts})),ma=da.selectById,fa=(da.selectAll,da.selectEntities),pa=_e.getSelectors((function(e){return e.calls})),ha=pa.selectById,ba=pa.selectAll,Ea=z.getSelectors((function(e){return e.staff})),va=(Ea.selectById,Ea.selectAll),ya=Xe.getSelectors((function(e){return e.facilities})),ga=(ya.selectById,ya.selectAll),Oa=mt.getSelectors((function(e){return e.kiosks})),ja=Oa.selectById,wa=(Oa.selectAll,Oa.selectEntities),Ca=function(e,t){var a=t.inmateIds.map((function(t){return ia(e,t)})).filter(Oe),n=t.userIds.map((function(t){return ma(e,t)})).filter(Oe),r=ja(e,t.kioskId);if(r)return Object(R.a)(Object(R.a)({},t),{},{inmates:a,contacts:n,kiosk:r})},ka=function(e,t){return t.map((function(t){return Ca(e,t)})).filter(Oe)},Sa=function(e,t){var a=ha(e,t);if(a)return Ca(e,a)},xa=function(e){var t=ba(e);return ka(e,t.filter((function(e){return("missing_monitor"===e.status||"live"===e.status)&&!!e.videoHandler})))},Ia=function(e,t){if(ia(e,t))return ba(e).filter((function(e){return t in e.inmateIds}))},Ta={padding:24},Da={borderRadius:6},Na={width:"100%"},Ma=["#eef6ff","#9ac1ec","#70a9e9","#0275D8","#004886"],Pa=a(509),Aa=a.n(Pa),Ha=a(131),La=a(541),Va=a(105),Ba=a(1210),Fa=a(208),Ra=a(510),qa=a(511),Za=a(512),za=function(){function e(t,a){Object(Ra.a)(this,e),this.callId=void 0,this.producerTransport=void 0,this.consumerTransport=void 0,this.device=void 0,this.consumers=void 0,this.producers=void 0,this.handlers=void 0,this.socket=void 0,this.socket=t,this.callId=a,this.producerTransport=null,this.consumerTransport=null,this.device=null,this.consumers={},this.producers={},this.handlers={consume:[]}}return Object(qa.a)(e,[{key:"request",value:function(){var e=Object(s.a)(o.a.mark((function e(t,a){var n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(!n.socket)return r("No socket connection.");n.socket.emit(t,a,(function(t){t.error?r(t.error):e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"handleTransportConnect",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.on("connect",function(){var n=Object(s.a)(o.a.mark((function n(r,c,l){var i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=r.dtlsParameters,n.next=3,a.request("establishDtls",{dtlsParameters:i,callId:a.callId,transportId:t.id});case 3:c(),e();case 5:case"end":return n.stop()}}),n)})));return function(e,t,a){return n.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,a,n,r,c=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request("join",{callId:this.callId});case 2:return t=e.sent,a=t.producerTransportInfo,n=t.consumerTransportInfo,r=t.routerRtpCapabilities,e.next=8,this.loadDevice(r);case 8:if(this.device=e.sent,this.device){e.next=11;break}return e.abrupt("return");case 11:return a&&(this.producerTransport=this.device.createSendTransport(a),this.handleTransportConnect(this.producerTransport)),this.consumerTransport=this.device.createRecvTransport(n),this.handleTransportConnect(this.consumerTransport),e.next=16,this.request("declareRtpCapabilities",{rtpCapabilities:this.device.rtpCapabilities});case 16:this.request("finishConnecting",{callId:this.callId}),this.producerTransport&&this.producerTransport.on("produce",function(){var e=Object(s.a)(o.a.mark((function e(t,a,n){var r,l,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.kind,l=t.rtpParameters,e.next=3,c.request("produce",{callId:c.callId,kind:r,rtpParameters:l});case 3:i=e.sent,s=i.producerId,a({id:s});case 6:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()),this.socket.on("consume",function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.consume(t);case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:n=a.consumer,r=a.stream,c.socket.emit("resumeConsumer",{callId:c.callId,consumerId:n.id}),c.handlers.consume.forEach((function(e){return e(t.kind,r,t.user)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadDevice",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Za.Device,e.next=3,a.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"consume",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.consumerTransport){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.consumerTransport.consume(t);case 4:return a=e.sent,n=new MediaStream([a.track]),this.consumers[a.id]=a,e.abrupt("return",{consumer:a,stream:n});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(){var e=Object(s.a)(o.a.mark((function e(t,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t in this.handlers||(this.handlers[t]=[]),this.handlers[t].push(a);case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request("terminate",{callId:this.callId});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.socket.off("connect"),this.socket.off("consume"),this.socket.off("textMessage"),this.socket.close(),this.consumerTransport&&this.consumerTransport.close(),this.producerTransport&&this.producerTransport.close(),this.consumerTransport=null,this.producerTransport=null,Object.values(this.producers).forEach((function(e){e.close()})),Object.values(this.consumers).forEach((function(e){e.close()})),this.consumers={},this.producers={},this.handlers={};case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Wa=(a(278),a(1208)),Ua=a(1225),_a=a(1226),Ga=a(1227),Ja=a(1228),Ka=a(1229),Ya=a(1230),Qa=a(1231),$a=Rt.a.SubMenu;function Xa(e){var t=e.alerts,a=e.terminateCall,c=e.lockCall,l=e.muteCall,i=e.unmuteCall,o=e.isAudioOn,s=e.openChat,d=e.closeChat,m=e.chatCollapsed,f=e.emitAlert,p=Object(n.useState)(null),h=Object(u.a)(p,2),b=h[0],E=h[1],v=r.a.createElement(Rt.a,null,r.a.createElement($a,{key:"alert",icon:r.a.createElement(Ua.a,null),title:"Send Alert"},t.map((function(e){return r.a.createElement(Rt.a.Item,{key:e.id,onClick:function(){return E(e)}},e.title)}))),r.a.createElement(Rt.a.Item,{key:"lock",icon:r.a.createElement(_a.a,null),onClick:function(){return c()}},"Lock"),r.a.createElement(Rt.a.Item,{key:"terminate",icon:r.a.createElement(Ga.a,null),onClick:function(){return a()}},"Terminate Call"),r.a.createElement(Rt.a.Item,{key:"mute",icon:o?r.a.createElement(Ja.a,null):r.a.createElement(Ka.a,null),onClick:function(){return o?l():i()}},o?"Mute":"Unmute"),r.a.createElement(Rt.a.Item,{key:"chat",icon:r.a.createElement(Ya.a,null),onClick:function(){return m?s():d()}},m?"View Chat":"Close Chat"));return r.a.createElement("div",{className:"video-commands-overlay"},r.a.createElement(qt.a,{overlay:v},r.a.createElement(g.a,null,r.a.createElement(Qa.a,null))),r.a.createElement(Wa.a,{title:"Are you sure you want to send this alert?",visible:!!b,onOk:function(){b&&f(b),E(null)},onCancel:function(){return E(null)}},r.a.createElement("p",null,"Send the following alert to the participants:"),r.a.createElement("p",null,null===b||void 0===b?void 0:b.body)))}function en(){return r.a.createElement("div",{className:"video-loading-spinner"},r.a.createElement(na.a,{tip:"Loading video call..."}))}var tn=r.a.memo((function(e){var t=e.callId,a=e.isVisible,c=e.width,l=e.height,i=e.socket,d=e.alerts,f=e.lockCall,p=e.muteCall,h=e.unmuteCall,b=e.isAudioOn,E=e.openChat,v=e.closeChat,y=e.chatCollapsed,g=e.addMessage,O=Object(m.e)((function(e){return e.session.authInfo})),j=Object(n.useState)(!1),w=Object(u.a)(j,2),C=w[0],k=w[1],S=Object(n.useState)(!1),x=Object(u.a)(S,2),I=x[0],T=x[1],D=Object(n.useState)(),N=Object(u.a)(D,2),M=N[0],P=N[1],A=Object(n.useCallback)(Object(s.a)(o.a.mark((function e(){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new za(i,t),e.next=3,a.init();case 3:P(a);case 4:case"end":return e.stop()}}),e)}))),[i,t]),H=function(){var e=Object(s.a)(o.a.mark((function e(a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M){e.next=2;break}return e.abrupt("return");case 2:M.request("textMessage",{callId:t,contents:a.body}).then((function(){return Ae("Alert succesfully issue.","Both parties have been notified.","success")}),(function(e){return Ae("Alert could not be sent.","Error message: ".concat(e),"error")}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){k(!0),I||Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.connected){e.next=6;break}return console.log("Not connected, so waiting until connected."),window.Debug=i,e.next=5,new Promise((function(e){return i.on("connect",e)}));case 5:console.log("[VideoChat] Connected");case 6:return e.next=8,new Promise((function(e){i.emit("authenticate",O,e)}));case 8:return e.next=10,A();case 10:console.log("[VideoChat] Authenticated"),T(!0);case 12:case"end":return e.stop()}}),e)})))()}),[O,i,A,I]),Object(n.useEffect)((function(){M&&I&&(console.log("[VideoChat] listening for text messages"),M.socket.on("textMessage",(function(e){var a=e.from,n={contents:e.contents,senderId:a.id,senderType:a.type,createdAt:(new Date).toISOString(),callId:t};g(t,n)})))}),[g,t,I,M]);var L=Object(n.useCallback)((function(e){null!==e&&M&&I&&Object(s.a)(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:M.on("consume",function(){var a=Object(s.a)(o.a.mark((function a(n,r,c){var l,i,s,u,d,m;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("[VideoChat] Received consume from ".concat(c.type," ").concat(c.id)),e&&("video"===n?(l="".concat(c.type,"-").concat(t,"-video"),(i=document.getElementById(l))?i.srcObject=r:((s=document.createElement("video")).style.width="50%",s.style.height="100%",s.srcObject=r,s.id=l,s.autoplay=!0,e.appendChild(s))):"audio"===n&&(u="".concat(c.type,"-").concat(t,"-audio"),(d=document.getElementById(u))?d.srcObject=r:((m=document.createElement("audio")).srcObject=r,m.autoplay=!0,m.id=u,m.muted=!b,e.appendChild(m))),k(!1));case 2:case"end":return a.stop()}}),a)})));return function(e,t,n){return a.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()}),[M,I,b,t]);return Object(n.useEffect)((function(){var e=document.getElementById("inmate-".concat(t,"-audio")),a=document.getElementById("user-".concat(t,"-audio"));e&&(e.muted=b),a&&(a.muted=b)}),[b,t]),Object(n.useEffect)((function(){if(M){var e=setInterval((function(){M.socket.emit("heartbeat",{callId:t})}),1e3);return function(){return clearInterval(e)}}}),[M,t]),r.a.createElement("div",{className:"video-wrapper",id:"call-".concat(t),style:{width:c,height:l,visibility:a?"visible":"hidden",display:a?"flex":"none"},ref:L},!b&&r.a.createElement(Ja.a,{style:{position:"absolute",bottom:24,right:24,fontSize:36,color:"red"}}),r.a.createElement(Xa,{alerts:d,terminateCall:function(){M&&(M.terminate(),Ae("Call #".concat(t," terminated"),"We notified both participants of the incident.","info"))},lockCall:function(){return f(t)},muteCall:function(){return p(t)},unmuteCall:function(){return h(t)},isAudioOn:b,emitAlert:H,openChat:function(){return E(t)},closeChat:function(){return v(t)},chatCollapsed:y}),C&&r.a.createElement(en,null))}));function an(e){var t=e.width,a=e.height;return r.a.createElement(Zt.a.Ribbon,{text:"Offline"},r.a.createElement(b.a,{style:{width:t,height:a},className:"video-wrapper"}))}var nn={backgroundColor:"white",boxShadow:"0 2px 4px rgb(53 72 88 / 7%",marginBottom:"16px",paddingLeft:24,paddingRight:24,display:"flex",alignItems:"center",lineHeight:1.2};function rn(e){var t=e.title,a=e.subtitle,n=e.extra;return r.a.createElement(f.a.Header,{style:Object(R.a)(Object(R.a)({},nn),{},{paddingTop:(null===n||void 0===n?void 0:n.length)?"72px":"48px",paddingBottom:(null===n||void 0===n?void 0:n.length)?"72px":"48px"})},r.a.createElement(p.b,{direction:"vertical",style:Na},r.a.createElement(E.a.Title,{level:3,style:{marginBottom:0}},t),r.a.createElement(E.a.Text,null,a),(null===n||void 0===n?void 0:n.length)&&r.a.createElement("hr",{style:{border:0,height:1,backgroundColor:"rgba(0,0,0,.15)"}}),r.a.createElement(h.a,{gutter:16,style:Na},null===n||void 0===n?void 0:n.map((function(e,t){return r.a.createElement(Va.a,{key:t},e)})))))}function cn(e){var t=e.message,a=t.senderType;return r.a.createElement(p.b,{direction:"vertical",align:"inmate"===a?"end":"start",style:{width:"100%"}},r.a.createElement(p.b,null,r.a.createElement(E.a.Text,{strong:!0},function(){switch(a){case"inmate":return"Incarcerated Person";case"doc":return"DOC";case"user":return"Visitor"}}()),r.a.createElement(E.a.Text,{type:"secondary"},Object(fe.a)(new Date(t.createdAt),"HH:mm"))),r.a.createElement(E.a.Text,null,t.contents))}var ln=f.a.Content,on=f.a.Sider,sn=$e.addMessage,un=Object(m.c)((function(e){return{visitations:xa(e)}})),dn=[1,2,4,6,8],mn=un((function(e){var t=e.visitations,a=Object(n.useState)(),c=Object(u.a)(a,2),l=c[0],i=c[1],o=Object(n.useState)(),s=Object(u.a)(o,2),d=s[0],m=s[1],b=Object(n.useState)([]),E=Object(u.a)(b,2),v=E[0],y=E[1],g=Object(n.useState)(!1),O=Object(u.a)(g,2),j=O[0],w=O[1],C=Object(n.useState)(1),k=Object(u.a)(C,2),S=k[0],x=k[1],I=Object(n.useState)(80),T=Object(u.a)(I,2),D=T[0],N=T[1],M=Object(n.useState)(1),P=Object(u.a)(M,2),A=P[0],H=P[1],L=Object(n.useState)({}),V=Object(u.a)(L,2),B=V[0],F=V[1],q=jt();Object(n.useEffect)((function(){var e=setInterval((function(){q(Ge({"call.status":["live","missing_monitor"]}))}),3e4);return function(){return clearInterval(e)}}),[]),Object(n.useEffect)((function(){var e;!l&&t[0]&&t[0].videoHandler&&i(Aa.a.connect("https://".concat(null===(e=t[0].videoHandler)||void 0===e?void 0:e.host),{transports:["websocket"]}))}),[i,l,t]),Object(n.useEffect)((function(){!d&&t.length>0&&m(t[0].id)}),[S,t,d]),Object(n.useEffect)((function(){var e=t.find((function(e){return e.id===d}));y((null===e||void 0===e?void 0:e.messages)||[])}),[d,t]);var Z=function(e){x(e),N(ee[e])},z=Object(n.useCallback)((function(e,t){q(sn({id:e,message:t}))}),[]);return r.a.createElement(ln,null,r.a.createElement(rn,{title:"Live Calls (".concat(t.length,")"),subtitle:"Monitor, send alerts and terminate calls if needed. All in real-time"}),r.a.createElement(f.a,null,r.a.createElement(ln,null,r.a.createElement(p.b,{direction:"vertical",style:Object(R.a)(Object(R.a)({},Na),Ta)},0===t.length&&r.a.createElement(Ha.a,{description:"There aren't any live calls currently."}),t.length>0&&r.a.createElement(La.a,{current:A,defaultCurrent:1,defaultPageSize:S,onChange:function(e,t){H(e)},pageSize:S,pageSizeOptions:dn.filter((function(e){return e<=t.length})).map((function(e){return"".concat(e)})),total:t.length,showSizeChanger:!0,onShowSizeChange:function(e,t){Z(t)}}),r.a.createElement(h.a,{gutter:16},t.map((function(e,a){return r.a.createElement(Va.a,{span:X[S],key:e.id},l?r.a.createElement(tn,{height:"".concat(D,"vh"),socket:l,callId:e.id,inmates:e.inmates,contacts:e.contacts,isVisible:a>=(A-1)*S&&a<(A-1)*S+S,width:"100%",alerts:te,muteCall:function(e){F(he.a.omit(B,e))},unmuteCall:function(e){return F(Object(R.a)(Object(R.a)({},B),{},Object(oe.a)({},e,!0)))},isAudioOn:e.id in B,openChat:function(e){var a=t.find((function(t){return t.id===e}));m(e),y((null===a||void 0===a?void 0:a.messages)||[]),w(!1)},closeChat:function(e){w(!0)},chatCollapsed:j,addMessage:z,lockCall:function(e){var a=t.findIndex((function(t){return t.id===e}));-1!==a&&(Z(1),H(a+1),m(a))}}):r.a.createElement(an,{width:"100%",height:"".concat(D,"vh")}))}))))),r.a.createElement(on,{theme:"light",width:300,collapsible:!0,defaultCollapsed:!0,reverseArrow:!0,collapsed:j,onCollapse:function(e){return w(e)}},!j&&r.a.createElement("div",{className:"vh-100"},r.a.createElement(Ba.a,{title:"Chat",extra:[r.a.createElement(Fa.a,{value:d,onSelect:function(e){return m(e)}},t.map((function(e){return r.a.createElement(Fa.a.Option,{value:e.id,key:e.id},"Call #",e.id)})))]})," ",r.a.createElement("div",{style:Ta},r.a.createElement(p.b,{direction:"vertical",style:{overflowY:"scroll",display:"flex",flexDirection:"column",height:"100%"}},v.map((function(e){return r.a.createElement(cn,{message:e})}))))))))})),fn=a(265),pn=a(549),hn=a(550),bn=(a(768),function(e){var t=e.visitations,a=Object(n.useState)([]),c=Object(u.a)(a,2),l=c[0],i=c[1];Object(n.useEffect)((function(){i(t.map((function(e){return function(e){var t=e.contacts.reduce((function(e,t){return"".concat(e,", ").concat(Ee(t))}),""),a=e.inmates.reduce((function(e,t){return"".concat(e,", ").concat(Ee(t))}),"");return{title:"".concat(a," <> ").concat(t),start:e.scheduledStart,end:e.scheduledEnd}}(e)})))}),[t]);return r.a.createElement("div",{className:"demo-app-main"},r.a.createElement(be.b,{plugins:[fn.b,pn.a,hn.a],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},initialView:"timeGridWeek",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!1,businessHours:!0,events:l,eventContent:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("b",null,e.timeText),r.a.createElement("i",null,e.event.title))},eventClick:function(e){window.confirm("Are you sure you want to delete the event '".concat(e.event.title,"'"))&&e.event.remove()},themeSystem:"bootstrap"}))}),En=f.a.Content,vn=Object(m.c)((function(e){return{visitations:ka(e,ba(e))}}))((function(e){var t=e.visitations;return r.a.createElement(En,null,r.a.createElement(Ba.a,{title:"Calendar"}),r.a.createElement("div",{style:Ta},r.a.createElement(bn,{visitations:t})))}));function yn(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],r=t[1],c=wt(ca),l=wt(fa),i=wt(ua);return Object(n.useEffect)((function(){var e=c.filter((function(e){return"pending"===e.status}));r(Le(e,l,i))}),[c,l,i]),a}var gn=a(78),On=a(1203),jn=function(e){var t=e.contact,a=e.navigate;return r.a.createElement(p.b,{direction:"vertical"},r.a.createElement(E.a.Text,null,"Name: ",Ee(t)),r.a.createElement(E.a.Text,null,"Visitor ID: ",t.id),r.a.createElement(E.a.Link,{onClick:function(){return a("/contacts/".concat(t.id))}},"View Full Profile"))},wn=function(e){var t=e.inmate,a=e.navigate;return r.a.createElement(p.b,{direction:"vertical"},r.a.createElement(E.a.Text,null,"Name: ",Ee(t)),r.a.createElement(E.a.Text,null,"Unique ID: ",t.inmateIdentification),r.a.createElement(E.a.Text,null,"DOB: ",Object(fe.a)(new Date(t.dateOfBirth),"dd/mm/yy")),r.a.createElement(E.a.Link,{onClick:function(){return a("/members/".concat(t.id))}},"View Full Profile"))},Cn=function(e){var t=e.connections,a=e.accept,n=e.reject,c=e.navigate;return r.a.createElement(On.a,{dataSource:t},r.a.createElement(On.a.Column,{title:"",dataIndex:"inmate",key:"inmateProfilePic",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Xt,{src:e.profileImagePath,fallback:Ee(e),size:64}))}}),r.a.createElement(On.a.Column,{title:"Inmate",dataIndex:"inmate",key:"inmateProfilePic",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(wn,{inmate:e,navigate:c}))}}),r.a.createElement(On.a.Column,{title:"",dataIndex:"contact",key:"contactProfilePic",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Xt,{src:e.profileImagePath,fallback:Ee(e),size:64}))}}),r.a.createElement(On.a.Column,{title:"Contact",dataIndex:"contact",key:"contactInfo",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(jn,{contact:e,navigate:c}))}}),r.a.createElement(On.a.Column,{title:"Relationship",dataIndex:"relationship",key:"relationship"}),r.a.createElement(On.a.Column,{title:"",key:"actions",render:function(e,t){return r.a.createElement(p.b,null,r.a.createElement(g.a,{type:"primary",onClick:function(){return a(t)}},"Accept"),r.a.createElement(g.a,{danger:!0,onClick:function(){return n(t)}},"Reject"))}}))},kn=rn,Sn=function(){var e=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],r=t[1],c=yn();return Object(n.useEffect)((function(){r(c.filter((function(e){return"pending"===e.status})))}),[c]),a}(),t=jt(),a=function(e,a){t(Ve({connectionId:e.id,status:a}))};return r.a.createElement(f.a.Content,null,r.a.createElement(kn,{title:"Approval Requests",subtitle:"Review all connection requests between incarcerated people in your facility and their loved one on the outside."}),r.a.createElement("div",{style:Ta},r.a.createElement(Cn,{accept:function(e){return a(e,"active")},reject:function(e){return a(e,"rejected")},connections:e,navigate:function(e){return t(Object(gn.d)(e))}})))},xn=a(329).a.RangePicker;function In(e){var t=e.setDuration,a=e.setStartDate,n=e.setEndDate,c=[1/0,3,5,10,15,20];Rt.a,c.map((function(e){return r.a.createElement(Rt.a.Item,{key:e,onClick:function(){return t(e)}},"<",e)}));return r.a.createElement(p.b,{align:"center"},r.a.createElement(xn,{onChange:function(e){e&&(e[0]&&a(1e3*e[0].unix()),e[1]&&n(1e3*e[1].unix()))}}))}var Tn=a(1232),Dn=a(1233),Nn=a(547),Mn=function(e){var t=e.calls,a=e.isLoading,n=e.navigate,c=e.openCancelCallModal;return r.a.createElement(On.a,{dataSource:t,loading:a},r.a.createElement(On.a.Column,{title:"Date",dataIndex:"scheduledStart",key:"date",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,Object(fe.a)(new Date(e),"MM/dd/yy")))}}),r.a.createElement(On.a.Column,{title:"Start Time",dataIndex:"scheduledStart",key:"startTime",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,Object(fe.a)(new Date(e),"HH:mm")))}}),r.a.createElement(On.a.Column,{title:"End Time",dataIndex:"scheduledEnd",key:"endTime",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,Object(fe.a)(new Date(e),"HH:mm")))}}),r.a.createElement(On.a.Column,{title:"Incarcerated Persons",dataIndex:"inmates",key:"inmateName",render:function(e){return e.map((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,Ee(e)))}))}}),r.a.createElement(On.a.Column,{title:"Unique Identifiers",dataIndex:"inmates",key:"inmateIds",render:function(e){return e.map((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,e.inmateIdentification))}))}}),r.a.createElement(On.a.Column,{title:"Contact Name",dataIndex:"contacts",key:"contactName",render:function(e){return e.map((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,Ee(e)))}))}}),r.a.createElement(On.a.Column,{title:"Status",dataIndex:"status",key:"location",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Nn.a,null,e))}}),r.a.createElement(On.a.Column,{title:"Recording",key:"action",render:function(e,t){return"scheduled"===t.status?r.a.createElement(g.a,{onClick:function(){return c(t)},icon:r.a.createElement(Tn.a,null)},"Cancel"):r.a.createElement(g.a,{onClick:function(){return n("/call/".concat(t.id))},icon:r.a.createElement(Dn.a,null)},"View")}}))},Pn={"inmateParticipants.inmateIdentification":"Inmate ID","inmateParticipants.lastName":"Inmate Last Name","userParticipants.lastName":"Contact Name","userParticipants.id":"Contact ID","kiosk.name":"Kiosk",status:"Call Status"},An=function(e){var t=e.calls,a=e.navigate,c=e.fetchCalls,l=e.openCancelCallModal,i=Object(n.useState)([]),d=Object(u.a)(i,2),m=d[0],p=d[1],h=Object(n.useState)(""),b=Object(u.a)(h,2),E=b[0],v=b[1],g=Object(n.useState)(""),O=Object(u.a)(g,2),j=O[0],w=O[1],C=Object(n.useState)(500),k=Object(u.a)(C,1)[0],S=Object(n.useState)(0),x=Object(u.a)(S,1)[0],I=Object(n.useState)(),T=Object(u.a)(I,2),D=T[0],N=T[1],M=Object(n.useState)(),P=Object(u.a)(M,2),A=P[0],H=P[1],L=Object(n.useState)(),V=Object(u.a)(L,2),B=V[0],F=V[1],R=Object(n.useState)(!1),q=Object(u.a)(R,2),Z=q[0],z=q[1],W=Object(n.useState)("inmateParticipants.inmateIdentification"),U=Object(u.a)(W,2),_=U[0],G=U[1],J=Object(n.useState)([]),K=Object(u.a)(J,2),Y=K[0],Q=K[1],$=Object(n.useCallback)(he.a.debounce((function(){return w(E)}),1e3),[E]);Object(n.useEffect)((function(){return $(),$.cancel}),[E,$]),Object(n.useEffect)((function(){z(!0),Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c((t={},Object(oe.a)(t,"".concat(_),j),Object(oe.a)(t,"scheduledStart",D&&A?{rangeStart:D,rangeEnd:A}:void 0),Object(oe.a)(t,"maxDuration",B),Object(oe.a)(t,"limit",k),Object(oe.a)(t,"offset",x),t)));case 1:case"end":return e.stop()}}),e)})))().then((function(){return z(!1)}))}),[c,k,x,D,A,B,j,_]),Object(n.useEffect)((function(){var e=t;if(D&&A&&(e=e.filter((function(e){return new Date(e.scheduledStart)>=new Date(D)&&new Date(e.scheduledStart)<=new Date(A)}))),E)switch(_){case"inmateParticipants.inmateIdentification":e=e.filter((function(e){return e.inmates.some((function(e){return we(E,e.inmateIdentification)}))}));break;case"inmateParticipants.lastName":e=e.filter((function(e){return e.inmates.some((function(e){return we(E,e.lastName)}))}));break;case"userParticipants.lastName":e=e.filter((function(e){return e.contacts.some((function(e){return we(E,e.lastName)}))}));break;case"userParticipants.id":e=e.filter((function(e){return e.contacts.some((function(e){return e.id===parseInt(E)}))}));break;case"kiosk.name":e=e.filter((function(e){return we(E,e.kiosk.name)}));break;case"status":if(!Y.length)break;e=e.filter((function(e){return Y.includes(e.status)}))}p(e)}),[t,p,D,A,_,E,Y]);var X=Xr.filter((function(e){return!Y.includes(e.value)}));return r.a.createElement(f.a.Content,null,r.a.createElement(kn,{title:"Search for Call Logs",subtitle:"Search by different parameters and retrieve recordings of past calls",extra:[r.a.createElement(y.a.Group,{compact:!0},r.a.createElement(Fa.a,{defaultValue:Object.keys(Pn)[0],onSelect:function(e){return G(e)}},Object.keys(Pn).map((function(e){return r.a.createElement(Fa.a.Option,{key:e,value:e},Pn[e])}))),"status"===_?r.a.createElement(Fa.a,{mode:"multiple",allowClear:!0,style:{width:"auto",minWidth:150},placeholder:"Filter by call status",onChange:function(e){return Q([].concat(Object(le.a)(Y),[e]))}},X.map((function(e){return r.a.createElement(Fa.a.Option,{key:e.key,value:e.value},e.label)}))):r.a.createElement(y.a.Search,{style:{width:"auto"},placeholder:"Search by ".concat(Pn[_],"..."),allowClear:!0,value:E,onChange:function(e){v(e.target.value)},onSearch:function(e){w(e)}})),r.a.createElement(In,{setStartDate:N,setEndDate:H,setDuration:F})]}),r.a.createElement("div",{style:Ta},r.a.createElement(Mn,{calls:m,isLoading:Z,navigate:a,openCancelCallModal:l})))},Hn=Object(m.c)((function(e){return{logs:ka(e,ba(e)).filter((function(e){return"ended"===e.status||"terminated"===e.status||"scheduled"===e.status}))}}),(function(e){return Object(q.b)({fetchCalls:Ge},e)}))((function(e){var t=e.logs,a=e.fetchCalls,n=jt();return r.a.createElement(An,{calls:t,fetchCalls:a,navigate:function(e){return n(Object(gn.d)(e))},openCancelCallModal:function(e){return n(Et({activeType:"CANCEL_CALL_MODAL",entity:e}))}})})),Ln=a(1199),Vn=a(1234),Bn=Fa.a.Option;function Fn(e){var t=e.data,a=e.onChange,n=v.a.useForm(),c=Object(u.a)(n,1)[0];return r.a.createElement(v.a,{form:c,name:"control-hooks"},r.a.createElement(v.a.Item,{name:"email",label:"Email",rules:[{type:"email",required:!0}]},r.a.createElement(y.a,{placeholder:"Email",prefix:r.a.createElement(Vn.a,{className:"site-form-item-icon"}),value:t.email,onChange:function(e){return a(Object(R.a)(Object(R.a)({},t),{},{email:e.target.value}))}})),r.a.createElement(v.a.Item,{name:"gender",label:"Role",rules:[{required:!0}]},r.a.createElement(Fa.a,{placeholder:"Select a role",value:t.role,onChange:function(e){return a(Object(R.a)(Object(R.a)({},t),{},{role:e}))},allowClear:!0},r.a.createElement(Bn,{value:"staff"},"Staff"),r.a.createElement(Bn,{value:"investigator"},"Investigator"),r.a.createElement(Bn,{value:"admin"},"Admin"))))}var Rn=On.a.Column,qn=f.a.Content,Zn=Object(m.c)((function(e){return{staff:va(e)}}),(function(e){return Object(q.b)({updateStaff:U},e)}))((function(e){var t=e.staff,a=(e.updateStaff,Object(n.useState)(null)),c=Object(u.a)(a,2),l=c[0],i=c[1],o=Object(n.useState)(),s=Object(u.a)(o,2),d=s[0],m=s[1],f=Object(n.useState)(!1),h=Object(u.a)(f,2),b=h[0],E=h[1],v=Object(n.useState)({email:"",role:""}),y=Object(u.a)(v,2),O=y[0],j=y[1],w=function(){switch(E(!0),l){case"edit":if(d)break}E(!1)};return r.a.createElement(qn,null,r.a.createElement(rn,{title:"Staff",subtitle:"Manage your staff, edit their access permissions, and add new members."}),r.a.createElement("div",{style:Ta},r.a.createElement(On.a,{dataSource:t},r.a.createElement(Rn,{title:"",key:"profileImagePath",render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Xt,{src:t.profileImagePath,fallback:Ee(t),size:48}))}}),r.a.createElement(Rn,{title:"First Name",dataIndex:"firstName",key:"firstName"}),r.a.createElement(Rn,{title:"Last Name",dataIndex:"lastName",key:"lastName"}),r.a.createElement(Rn,{title:"Role",dataIndex:"role",key:"role",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Nn.a,{color:"blue",key:e},e||"Operator"))}}),r.a.createElement(Rn,{title:"",key:"edit",render:function(e,t){return r.a.createElement(g.a,{onClick:function(){m(t),i("edit")}},"Edit")}}))),r.a.createElement(Wa.a,{title:"Add Staff",visible:"create"===l,onOk:w,confirmLoading:b,onCancel:function(){return i(null)}},r.a.createElement(Fn,{data:O,onChange:j})),r.a.createElement(Wa.a,{title:"Edit Staff",visible:"edit"===l,onOk:w,confirmLoading:b,onCancel:function(){return i(null)}},d&&r.a.createElement(p.b,{direction:"vertical",size:"small",style:{width:"100%"}},r.a.createElement("span",null,"Name: ",Ee(d)),r.a.createElement("span",null,"Role: ",d.role),r.a.createElement("span",null,"Email: ",d.email),r.a.createElement(Ln.a,null))))})),zn=f.a.Content,Wn={push:gn.d},Un=Object(m.c)((function(e){return{inmates:oa(e)}}),Wn)((function(e){var t=e.inmates,a=e.push,n=[{title:"",editable:!1,render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Xt,{fallback:Ee(t),src:t.profileImagePath,size:48}))}},{title:"Unique ID",dataIndex:"inmateIdentification",editable:!0},{title:"First Name",dataIndex:"firstName",editable:!0},{title:"Last Name",dataIndex:"lastName",editable:!0},{title:"Location",dataIndex:"location",editable:!0},{title:"",key:"action",editable:!1,render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{onClick:function(){return a("/members/".concat(t.id))},icon:r.a.createElement(Dn.a,null)},"View"))}}];return r.a.createElement(zn,null,r.a.createElement(rn,{title:"Incarcerated People",subtitle:"Manage the members of your facility, access detailed information, and edit their info as needed."}),r.a.createElement("div",{style:Ta},r.a.createElement(On.a,{dataSource:t,columns:n})))})),_n=function(e){var t=e.person,a=e.relationship,n=e.type,c=e.navigate,l=Ee(t);return r.a.createElement(Va.a,{span:8},r.a.createElement("div",{onClick:function(){return c("/".concat("inmate"===n?"members":"contacts","/").concat(t.id))}},r.a.createElement(p.b,{direction:"vertical"},r.a.createElement(Xt,{src:t.profileImagePath,fallback:l,size:48}),r.a.createElement(E.a.Text,null,l),r.a.createElement(E.a.Text,{type:"secondary"},a))))},Gn=function(e){var t=e.connections,a=e.type,n=e.navigate;return r.a.createElement(b.a,{title:"Connections"},!t.length&&r.a.createElement(Ha.a,{description:"No Connections"}),r.a.createElement(h.a,{justify:"space-between"},t.map((function(e){var t="inmate"===a?e.inmate:e.contact;return r.a.createElement(_n,{person:t,relationship:e.relationship,navigate:n,type:a})}))))},Jn=a(1213),Kn=function(e){var t=e.type,a=e.facilityName,n=e.persona,c=[{path:"/",breadcrumbName:a},{path:"/members",breadcrumbName:"Incarcerated People"},{path:"/",breadcrumbName:Ee(n)}];return r.a.createElement(Ba.a,{ghost:!1,onBack:function(){return window.history.back()},title:Ee(n),breadcrumb:{routes:c},style:{marginBottom:32}},function(){switch(t){case"inmate":return r.a.createElement(Jn.a,{size:"small",column:3,bordered:!0},r.a.createElement(Jn.a.Item,{label:"First Name"},n.firstName),r.a.createElement(Jn.a.Item,{label:"Last Name"},n.lastName),r.a.createElement(Jn.a.Item,{label:"Unique ID"},n.inmateIdentification),r.a.createElement(Jn.a.Item,{label:"DOB"},Object(fe.a)(new Date(n.dateOfBirth),"yyyy-MM-dd")),r.a.createElement(Jn.a.Item,{label:"Call Quota"},n.quota));case"contact":return r.a.createElement(Jn.a,{size:"small",column:3,bordered:!0},r.a.createElement(Jn.a.Item,{label:"First Name"},n.firstName),r.a.createElement(Jn.a.Item,{label:"Last Name"},n.lastName),r.a.createElement(Jn.a.Item,{label:"Last Name"},n.email),r.a.createElement(Jn.a.Item,{label:"Front ID"},r.a.createElement($t.a,{width:200,src:n.frontIdPath})),r.a.createElement(Jn.a.Item,{label:"Back ID"},r.a.createElement($t.a,{width:200,src:n.backIdPath})),r.a.createElement(Jn.a.Item,{label:"Selfie"},r.a.createElement($t.a,{width:200,src:n.selfiePath})))}}())},Yn=a(1215),Qn=a(1235),$n=function(e){var t=e.call,a=e.type,n=e.navigate;return function(){var e=r.a.createElement(E.a.Text,{strong:!0},"inmate"===a?Ne(t):De(t)),c=Object(fe.a)(new Date(t.scheduledStart),"MM/dd HH:mm");switch(t.status){case"pending_approval":return r.a.createElement(Yn.a.Item,{label:c,color:"yellow"},"Call with ",e," is pending approval");case"scheduled":return r.a.createElement(Yn.a.Item,{label:c,color:"yellow"},"Call scheduled with ",e);case"cancelled":return r.a.createElement(Yn.a.Item,{label:c,color:"red"},"Call with ",e," was cancelled");case"no_show":return r.a.createElement(Yn.a.Item,{label:c,color:"red"},"Did not show up for call with ",e);case"missing_monitor":case"live":return r.a.createElement(Yn.a.Item,{label:c,color:"green"},"Call happening with ",e);case"terminated":case"ended":return"done"===t.recordingStatus?r.a.createElement(Yn.a.Item,{label:Object(fe.a)(new Date(t.scheduledStart),"MM/dd HH:mm")},r.a.createElement(E.a.Link,{onClick:function(){return n("/call/".concat(t.id))}},"Called ",e)):r.a.createElement(Yn.a.Item,{dot:r.a.createElement(Qn.a,{style:{fontSize:"16px"}}),label:c},r.a.createElement(E.a.Link,{onClick:function(){return n("/call/".concat(t.id))}},"Processsing call with ",e));default:return r.a.createElement("div",null)}}()},Xn=function(e){var t=e.calls,a=e.type,n=e.navigate;return r.a.createElement(b.a,{title:"Call Activity",style:{maxHeight:"60vh",overflowY:"scroll"}},!t.length&&r.a.createElement(Ha.a,{description:"No Calls"}),r.a.createElement(Yn.a,{mode:"right"},t.map((function(e){return r.a.createElement($n,{key:e.id,call:e,type:a,navigate:n})}))))},er=function(e){var t=e.calls,a=e.connections,n=e.type,c=e.facilityName,l=e.persona,i=e.navigate;return r.a.createElement(f.a,null,r.a.createElement(f.a.Content,{style:Object(R.a)({},Ta)},r.a.createElement(Kn,{type:n,persona:l,facilityName:c}),r.a.createElement(h.a,{justify:"space-between",gutter:12},r.a.createElement(Va.a,{span:16},r.a.createElement(Xn,{calls:t,type:n,navigate:i})),r.a.createElement(Va.a,{span:8},r.a.createElement(Gn,{connections:a,type:n,navigate:i})))))};var tr=function(e){var t=e.match,a=Object(m.e)((function(e){var t;return null===(t=e.facilities.selected)||void 0===t?void 0:t.name})),c=t.params.id,l=Object(m.e)((function(e){return ia(e,c)})),i=function(e){var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1],l=yn();return Object(n.useEffect)((function(){c(l.filter((function(t){return t.inmateId===e})))}),[l,e]),r}((null===l||void 0===l?void 0:l.id)||-1),o=function(e){var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1],l=wt(ba),i=wt(fa),o=wt(ua),s=wt(wa);return Object(n.useEffect)((function(){var t=l.filter((function(t){return t.inmateIds.includes(e)}));c(Te(t,i,o,s))}),[l,o,i,s,e]),r}((null===l||void 0===l?void 0:l.id)||-1),s=jt();return Object(n.useEffect)((function(){s(Ge({"inmateParticipants.inmateId":c}))}),[c,s]),l&&a?r.a.createElement(er,{connections:i,persona:l,facilityName:a,calls:o,type:"inmate",navigate:function(e){return s(Object(gn.d)(e))}}):r.a.createElement("div",null)},ar={push:gn.d};var nr=Object(m.c)((function(e,t){return{calls:ka(e,Ia(e,parseInt(t.match.params.id))||[])}}),ar)((function(e){var t=e.calls,a=e.match,c=Object(m.e)((function(e){var t;return null===(t=e.facilities.selected)||void 0===t?void 0:t.name})),l=jt(),i=Object(m.e)((function(e){return ma(e,a.params.id)})),o=function(e){var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1],l=yn();return Object(n.useEffect)((function(){c(l.filter((function(t){return t.userId===e})))}),[l,e]),r}((null===i||void 0===i?void 0:i.id)||-1);return i&&c?r.a.createElement(er,{connections:o,persona:i,facilityName:c,calls:t,type:"contact",navigate:function(e){return l(Object(gn.d)(e))}}):r.a.createElement("div",null)})),rr=a(1237),cr=a(1238),lr=a(1239),ir=a(532),or=a(1200),sr=a(1206);function ur(e){var t=e.title,a=e.value,n=e.suffix,c=e.prefix;return r.a.createElement(b.a,null,r.a.createElement(sr.a,{title:t,value:a,prefix:c,suffix:n}))}var dr=a(258);function mr(e){var t=e.title,a={labels:e.labels,datasets:[{data:e.data,backgroundColor:e.backgroundColor,hoverBackgroundColor:e.hoverBackgroundColor}]};return r.a.createElement(b.a,{title:t,style:Da},r.a.createElement(dr.Doughnut,{data:a}))}var fr="rgba(0, 137, 255, 1)",pr=function(e){var t=e.title,a=e.label,n=e.labels,c=e.data,l={labels:n,datasets:[{label:a,lineTension:.1,backgroundColor:"rgba(0, 137, 255, 0.4)",borderColor:fr,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:fr,pointBackgroundColor:"#fff",pointBorderWidth:5,pointHoverRadius:8,pointHoverBackgroundColor:fr,pointHoverBorderColor:"rgba(2, 117, 216, 1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:c}]};return r.a.createElement(b.a,{title:t},r.a.createElement(dr.Line,{data:l}))},hr=a(14),br=function(e){var t=e.width,a=e.height,n=e.color||"#424242";return r.a.createElement(hr.Svg,{viewBox:"0 0 666.85 257.93",style:{width:t||100,height:a||30}},r.a.createElement(hr.Path,{fill:n,stroke:"#fff",strokeWidth:3,d:"M111.83,48.88h0l-8.38,20.22L98.27,81.58l0,0v.08L91.48,98h0L90,101.55h0l-2.9,7-.6-2.23-.64-2.43-4-15.27L71,47.66l-1.6-6.1L63.79,20.1Z"}),r.a.createElement(hr.Polygon,{fill:n,stroke:"#fff",strokeWidth:3,opacity:.7,points:"87.09 108.56 85.99 107.12 84.4 105.05 77.65 96.2 71.96 88.74 50.31 60.32 41.21 48.39 71.04 47.66 81.83 88.63 85.85 103.9 86.49 106.33 87.09 108.56"}),r.a.createElement(hr.Polygon,{fill:n,stroke:"#fff",strokeWidth:3,points:"67.95 154.72 59.71 174.61 29.58 171.5 58.55 149.76 64.48 145.32 75.17 137.31 67.96 154.69 67.95 154.72"}),r.a.createElement(hr.Path,{fill:n,stroke:"#fff",strokeWidth:3,d:"M134.41,137.69h0L81.75,151.16l-2.83.73-11,2.8,7.21-17.38h0l2.27-5.48h0l9.54-23,.1-.23h0l2.9-7h0L91.47,98h0l6.75-16.29h0l0-.09,5.17-12.47,8.38-20.22h0l4,15.53,4.51,17.78,4.95,19.43,3,11.89h0Z"}),r.a.createElement(hr.Polygon,{fill:n,stroke:"#fff",strokeWidth:3,points:"161.52 72.3 156.34 84.79 151.4 96.73 147.81 105.36 146.74 107.93 146.74 107.94 134.41 137.69 128.27 113.52 128.26 113.52 125.24 101.63 120.29 82.2 120.3 82.19 121.87 81.82 141.5 77.1 160.2 72.62 161.52 72.3"}),r.a.createElement(hr.Polygon,{fill:n,stroke:"#fff",strokeWidth:3,opacity:.7,points:"187.8 89.91 179.44 91.47 170.42 93.17 170.41 93.16 151.4 96.73 156.34 84.79 161.52 72.3 162.14 72.71 187.8 89.91"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M234.77,211.91h-17.2L209.18,190H163l-8.4,21.88H137.37l38.93-98.23h19.54Zm-66-36.73H203.4l-17.33-45.27Z"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M259.67,211.91H245V161.28h-5.64V148.07h11.83l6.19,6.2c5.5-4.54,12.24-7.43,18.57-7.43a20.61,20.61,0,0,1,17.34,8.66,31.53,31.53,0,0,1,21-8.66c11.7,0,22.43,8,22.43,26.55v38.52H322V173.39c0-8.39-4.54-12.93-11.28-12.93-7.57,0-12.52,4.54-12.52,10.59v40.86H283.61V173.39c0-8.39-4.68-12.93-11.29-12.93-7.42,0-12.65,4.4-12.65,10.18Z"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M393.53,190.72l12.1,6.61c-4.95,8.39-14.17,16.09-26.82,16.09-18.3,0-31.37-15.41-31.37-33.29s13.07-33.57,31.23-33.57,29.44,15.27,30,31.92l-5.5,5.36H362.3c.82,9.5,8.11,15.82,16.51,15.82C384.58,199.66,390.36,196,393.53,190.72ZM363,172.15h30.95c-1-7.15-7.43-12.52-15.27-12.52A15.72,15.72,0,0,0,363,172.15Z"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M461.76,190.72l12.11,6.61c-4.95,8.39-14.17,16.09-26.83,16.09-18.3,0-31.37-15.41-31.37-33.29s13.07-33.57,31.23-33.57,29.44,15.27,30,31.92l-5.5,5.36H430.53c.83,9.5,8.12,15.82,16.51,15.82C452.82,199.66,458.6,196,461.76,190.72Zm-30.54-18.57h30.95c-1-7.15-7.42-12.52-15.27-12.52A15.72,15.72,0,0,0,431.22,172.15Z"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M489.41,113.68l4.82-5h10.18V197.6h5.64v14.31H495.6l-6.19-6.33Z"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M540.73,211.91H526V161.28h-5.5V148.07h15l5.23,5.23ZM532,112a10.49,10.49,0,0,1,10.39,10.39A10.37,10.37,0,0,1,532,132.67a10.25,10.25,0,0,1-10.25-10.26A10.37,10.37,0,0,1,532,112Z"}),r.a.createElement(hr.Path,{fill:"#1a1a1a",d:"M620,180a33.36,33.36,0,1,1-33.29-33.29A33.35,33.35,0,0,1,620,180Zm-15,0c0-10.32-7.71-19.12-18.3-19.12s-18.44,8.8-18.44,19.12,7.85,19.26,18.44,19.26S605,190.31,605,180Z"}))},Er=hr.StyleSheet.create({container:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:16},header:{flexDirection:"row",alignItems:"center"},extraColumn:{flexDirection:"column",alignSelf:"flex-end"},detailColumn:{flexDirection:"column"},name:{fontSize:18,fontWeight:"bold"},subtitle:{fontSize:10}}),vr=function(e){var t=e.title,a=e.subtitle;return r.a.createElement(hr.View,{style:Er.container,fixed:!0},r.a.createElement(hr.View,{style:Er.detailColumn},r.a.createElement(hr.View,{style:Er.header},r.a.createElement(hr.Text,{style:Er.name},t)),r.a.createElement(hr.Text,{style:Er.subtitle},a)),r.a.createElement(hr.View,{style:Er.extraColumn},r.a.createElement(br,{width:180,height:45})))},yr=hr.StyleSheet.create({container:{width:"100%",backgroundColor:"#CECECE",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",paddingVertical:4},title:{fontWeight:"semibold",fontSize:18}}),gr=function(e){var t=e.title;return r.a.createElement(hr.View,{style:yr.container},r.a.createElement(hr.Text,{style:yr.title},t))},Or=function(){return r.a.createElement(hr.Svg,{width:"18",height:"12",viewBox:"0 0 18 12"},r.a.createElement(hr.Path,{d:"M14 4.5V1C14 0.45 13.55 0 13 0H1C0.45 0 0 0.45 0 1V11C0 11.55 0.45 12 1 12H13C13.55 12 14 11.55 14 11V7.5L16.29 9.79C16.92 10.42 18 9.97 18 9.08V2.91C18 2.02 16.92 1.57 16.29 2.2L14 4.5Z",fill:"#757575"}))},jr=function(){return r.a.createElement(hr.Svg,{width:"16",height:"20",viewBox:"0 0 16 20"},r.a.createElement(hr.Path,{d:"M9.17 0H2C0.9 0 0 0.9 0 2V18C0 19.1 0.9 20 2 20H14C15.1 20 16 19.1 16 18V6.83C16 6.3 15.79 5.79 15.41 5.42L10.58 0.59C10.21 0.21 9.7 0 9.17 0ZM8 8C9.1 8 10 8.9 10 10C10 11.1 9.1 12 8 12C6.9 12 6 11.1 6 10C6 8.9 6.9 8 8 8ZM12 16H4V15.43C4 14.62 4.48 13.9 5.22 13.58C6.07 13.21 7.01 13 8 13C8.99 13 9.93 13.21 10.78 13.58C11.52 13.9 12 14.62 12 15.43V16Z",fill:"#757575"}))},wr=function(){return r.a.createElement(hr.Svg,{width:"16",height:"16",viewBox:"0 0 16 16"},r.a.createElement(hr.Path,{d:"M8 8C10.21 8 12 6.21 12 4C12 1.79 10.21 0 8 0C5.79 0 4 1.79 4 4C4 6.21 5.79 8 8 8ZM8 10C5.33 10 0 11.34 0 14V15C0 15.55 0.45 16 1 16H15C15.55 16 16 15.55 16 15V14C16 11.34 10.67 10 8 10Z",fill:"#757575"}))},Cr=function(){return r.a.createElement(hr.Svg,null,r.a.createElement(hr.Path,{d:"M0.153625 4.10988L3.68013 3.83725L5.99198 11.435L0.153625 4.10988Z",fill:"#424242"}),r.a.createElement(hr.Path,{d:"M2.91382 0.266663L6.37 11.6285L9.28279 3.83727L2.91382 0.266663Z",fill:"#424242"}),r.a.createElement(hr.Path,{d:"M0 19.3061L5.1687 14.8984L3.41543 19.5875L0 19.3061Z",fill:"#424242"}),r.a.createElement(hr.Path,{d:"M9.37788 4.4393L4.2843 18.0621L8.03616 17.1051L12.8564 15.8755L9.37788 4.4393Z",fill:"#424242"}),r.a.createElement(hr.Path,{d:"M10.8826 8.3353L16.0888 7.00812L12.9954 15.2814L10.8826 8.3353Z",fill:"#424242"}),r.a.createElement(hr.Path,{d:"M15.245 10.1198L16.4421 6.91776L19.959 8.90373L15.245 10.1198Z",fill:"#424242"}))},kr=hr.StyleSheet.create({container:{},card:{borderBottomStyle:"solid",borderBottomWidth:2,borderBottomColor:"#EEEEEE",display:"flex",flexDirection:"column"},header:{backgroundColor:"#EEEEEE",display:"flex",flexDirection:"row",justifyContent:"space-between",flexGrow:0,paddingVertical:4,paddingHorizontal:16},headerText:{fontWeight:"semibold",fontSize:16},row:{display:"flex",flexDirection:"row",padding:16},rowFirstItem:{flex:1,flexShrink:0,flexDirection:"row",display:"flex",alignItems:"center"},rowItem:{flex:1,flexShrink:0,display:"flex",flexDirection:"column"},itemTitle:{textTransform:"uppercase",fontSize:12,fontWeight:"light"},itemBody:{fontWeight:"semibold",fontSize:14},icon:{marginRight:8},logoIcon:{maxHeight:20,maxWidth:20}}),Sr=function(e){var t=e.calls,a=e.canViewDetails;return r.a.createElement(hr.View,{style:kr.container},t.map((function(e){return r.a.createElement(hr.View,{key:e.id,style:kr.card},r.a.createElement(hr.View,{style:kr.header},r.a.createElement(hr.Text,{style:kr.headerText},Object(fe.a)(new Date(e.scheduledStart),"HH:mm aaa")," -"," ",Object(fe.a)(new Date(e.scheduledEnd),"HH:mm aaa")),r.a.createElement(hr.View,{style:kr.logoIcon},r.a.createElement(Cr,null))),r.a.createElement(hr.View,{style:kr.row},r.a.createElement(hr.View,{style:kr.rowFirstItem},r.a.createElement(hr.View,{style:kr.icon},r.a.createElement(Or,null)),r.a.createElement(hr.View,null,r.a.createElement(hr.Text,{style:kr.itemTitle},"Call ID"),r.a.createElement(hr.Text,{style:kr.itemBody},e.id))),r.a.createElement(hr.View,{style:kr.rowItem},r.a.createElement(hr.Text,{style:kr.itemTitle},"Call Station"),r.a.createElement(hr.Text,{style:kr.itemBody},e.kiosk.name))),e.inmates.map((function(e){return r.a.createElement(hr.View,{style:kr.row,key:e.id},r.a.createElement(hr.View,{style:kr.rowFirstItem},r.a.createElement(hr.View,{style:kr.icon},r.a.createElement(wr,null)),r.a.createElement(hr.View,null,r.a.createElement(hr.Text,{style:kr.itemTitle},"Participant"),r.a.createElement(hr.Text,{style:kr.itemBody},Ee(e)))),r.a.createElement(hr.View,{style:kr.rowItem},r.a.createElement(hr.Text,{style:kr.itemTitle},"Unique ID"),r.a.createElement(hr.Text,{style:kr.itemBody},e.inmateIdentification)))})),a&&r.a.createElement(hr.View,{style:kr.row},r.a.createElement(hr.View,{style:kr.rowFirstItem},r.a.createElement(hr.View,{style:kr.icon},r.a.createElement(jr,null)),r.a.createElement(hr.View,null,r.a.createElement(hr.Text,{style:kr.itemTitle},"Contact Name"),e.contacts.map((function(e){return r.a.createElement(hr.Text,{key:"".concat(e.id,"-").concat(e.firstName,"-").concat(e.lastName),style:kr.itemBody},Ee(e))})))),r.a.createElement(hr.View,{style:kr.rowItem},r.a.createElement(hr.Text,{style:kr.itemTitle},"Contact ID"),e.contacts.map((function(e){return r.a.createElement(hr.Text,{key:e.id,style:kr.itemBody},e.id)})))))})))},xr=hr.StyleSheet.create({container:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",position:"absolute",bottom:16,left:16,width:"100%"},footerText:{fontSize:12}}),Ir=function(){return r.a.createElement(hr.View,{style:xr.container,fixed:!0},r.a.createElement(hr.Text,{style:xr.footerText},"ameelio.org"),r.a.createElement(hr.Text,{style:xr.footerText,render:function(e){var t=e.pageNumber,a=e.totalPages;return"".concat(t," / ").concat(a)}}))},Tr=hr.StyleSheet.create({page:{padding:30},container:{flex:1,flexDirection:"row"},blockContainer:{borderRadius:8,borderStyle:"solid",borderColor:"#CECECE",borderWidth:2,marginBottom:16}}),Dr=r.a.memo((function(e){var t=e.callBlocks,a=e.facility,n=e.canViewDetails;return r.a.createElement(hr.Document,{author:"Ameelio.org",keywords:"schedule, conneect",title:"Daily Schedule"},r.a.createElement(hr.Page,{style:Tr.page,wrap:!0},r.a.createElement(vr,{title:"Daily Activity Report | ".concat(Object(fe.a)(new Date,"MMMM dd, yyyy")),subtitle:"".concat(a.name)}),Object.keys(t).map((function(e){return r.a.createElement(hr.View,{key:e,style:Tr.blockContainer},r.a.createElement(gr,{title:Object(fe.a)(new Date(e),"HH:mm aaa")}),r.a.createElement(Sr,{calls:t[e],canViewDetails:n}))})),r.a.createElement(Ir,null)))})),Nr=a(1236),Mr=r.a.memo((function(e){var t=e.calls,a=e.facility,c=e.canViewDetails,l=Object(n.useState)(!1),i=Object(u.a)(l,2),o=i[0],s=i[1];if(Object(n.useEffect)((function(){setTimeout((function(){return s(!0)}),2e3)}),[]),!o)return r.a.createElement(g.a,{disabled:!0,loading:!0},"Generating daily report...");var d=c?"(Admin)":"(Public)";return r.a.createElement(hr.PDFDownloadLink,{document:r.a.createElement(Dr,{callBlocks:je(t,(function(e){return e.scheduledStart})),facility:a,canViewDetails:c}),fileName:"Daily Schedule (".concat(d,") | ").concat(a.name,"@").concat(Object(fe.a)(new Date,"MM/dd/yyyy-HH:mm"))},r.a.createElement(g.a,{icon:r.a.createElement(Nr.a,null)},"Download Schedule ",d))})),Pr=function(e){var t=e.calls,a=e.totalInmates,c=e.facility,l=e.lastUpdatedAt,i=e.isRefreshing,o=e.refresh,s=Object(n.useState)(),d=Object(u.a)(s,2),m=d[0],b=d[1],v=Object(n.useState)(),y=Object(u.a)(v,2),O=y[0],j=y[1],w=Object(n.useState)(0),C=Object(u.a)(w,2),k=C[0],S=C[1];return Object(n.useEffect)((function(){var e=setInterval((function(){S(Object(or.a)(new Date,l))}),1e3);return function(){return clearInterval(e)}}),[l]),Object(n.useEffect)((function(){var e=je(t.filter((function(e){return!!e.rating})),(function(e){return e.rating}),[1,2,3,4,5]),a=Object.keys(e).sort();b(a.map((function(t){return e[parseInt(t)].length}))),j(function(e){for(var t=new Date,a=Se(t),n={},r=Se(Object(me.a)(t));r<=a;){var c=Object(be.a)(r,1);n[Object(fe.a)(r,"MMM dd")]=xe(e,r,c).length,r=c}return n}(t))}),[t]),m&&O?r.a.createElement(f.a,null,r.a.createElement(rn,{title:"Dashboard",subtitle:"Analyze your facility data and print the daily call schedule.",extra:[r.a.createElement(Mr,{calls:Ie(t),facility:c,canViewDetails:!0}),r.a.createElement(Mr,{calls:Ie(t),facility:c,canViewDetails:!1}),r.a.createElement("div",null,k>5&&!i&&r.a.createElement("div",null,r.a.createElement(E.a.Text,{type:"secondary",className:"italic"},"Computed ",k," minutes ago"),r.a.createElement(g.a,{type:"link",onClick:o},"Refresh"))),r.a.createElement("div",null,i&&r.a.createElement("div",null,r.a.createElement(na.a,null),r.a.createElement(E.a.Text,{type:"secondary"},"Updating with live data")))]}),r.a.createElement(ir.Content,null,r.a.createElement(p.b,{direction:"vertical",style:Object(R.a)(Object(R.a)({},Na),Ta),size:"large"},r.a.createElement(h.a,{gutter:16},r.a.createElement(Va.a,{span:8,className:"bg-white"},r.a.createElement(ur,{title:"Calls This Week",value:Object.values(O)[Object.values(O).length-1],prefix:r.a.createElement(rr.a,null),suffix:"calls"})),r.a.createElement(Va.a,{span:8,className:"bg-white"},r.a.createElement(ur,{title:"Live Video Calls",value:t.filter((function(e){return"live"===e.status||"missing_monitor"===e.status})).length,prefix:r.a.createElement(cr.a,null),suffix:"calls"})),r.a.createElement(Va.a,{span:8,className:"bg-white"},r.a.createElement(ur,{title:"Facility Video Usage",value:(100*t.map((function(e){return e.inmateIds})).reduce((function(e,t){return[].concat(Object(le.a)(e),Object(le.a)(t))}),[]).filter(ve).length/a).toFixed(2),suffix:"%",prefix:r.a.createElement(lr.a,null)}))),r.a.createElement(h.a,{gutter:16},r.a.createElement(Va.a,{span:12},r.a.createElement(pr,{title:"Calls",label:"# calls",labels:Object.keys(O),data:Object.values(O)})),r.a.createElement(Va.a,{span:12},r.a.createElement(mr,{title:"Ratings Breakdown ".concat(Object(fe.a)(new Date,"MMMM")),data:m,backgroundColor:Ma,hoverBackgroundColor:Ma,labels:["Terrible","Poor","Okay","Good","Amazing"]})))))):r.a.createElement("div",null)},Ar=a(1201),Hr=function(){var e=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],r=t[1],c=wt(ba),l=wt(fa),i=wt(ua),o=wt(wa);return Object(n.useEffect)((function(){r(Te(c,l,i,o))}),[c,i,l,o]),a}(),t=wt(sa),a=wt((function(e){return e.facilities.selected})),c=Object(n.useState)(new Date),l=Object(u.a)(c,2),i=l[0],o=l[1],s=Object(n.useState)(!1),d=Object(u.a)(s,2),m=d[0],f=d[1],p=jt();return a?r.a.createElement(Pr,{calls:e,totalInmates:t,facility:a,lastUpdatedAt:i,refresh:function(){f(!0),p(Ge({scheduledStart:{rangeStart:Object(me.a)(new Date).getTime(),rangeEnd:Object(Ar.a)(new Date).getTime()}})),o(new Date),f(!1)},isRefreshing:m}):r.a.createElement("div",null)},Lr=a(1202),Vr=a(1209),Br=a(97),Fr=a.n(Br),Rr=a(330),qr=Rr.a.TabPane,Zr=Lr.a.RangePicker,zr=f.a.Content;var Wr=function(){var e=Object(n.useState)(),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)("setting"),i=Object(u.a)(l,2),o=i[0],s=i[1],d=Object(n.useState)([]),m=Object(u.a)(d,2),f=m[0],v=m[1],y=wt((function(e){return e.groups.nodes})),O=wt((function(e){return e.facilities.selected})),j=jt();if(Object(n.useEffect)((function(){O&&(v(O.callTimes),c(function(e){var t=he.a.groupBy(e,(function(e){return e.day})),a=$.map((function(e){return e in t?[e,t[e].sort((function(e,t){return e.hour>t.hour?1:e.hour<t.hour?-1:e.minute>t.minute?1:e.minute<t.minute?-1:1}))]:[e,[]]})),n=0,r=a.map((function(e){var t=Object(u.a)(e,2),a=t[0],r=t[1];if(!r.length)return Object(oe.a)({},a,[]);var c,l=[],i=r[0],o=r[0],s=Object(ie.a)(r.slice(1,r.length));try{for(s.s();!(c=s.n()).done;){var d=c.value;i.hour===d.hour||d.hour===i.hour+1&&0===d.minute?i=d:(l.push({duration:18e5,start:Ce(o),end:ke(i),idx:n,day:o.day}),o=d,i=d,n+=1)}}catch(m){s.e(m)}finally{s.f()}return l.push({duration:18e5,start:Ce(o),end:ke(i),idx:n,day:o.day}),Object(oe.a)({},a,l)}));return Object.assign.apply(Object,[{}].concat(Object(le.a)(r)))}(O.callTimes)))}),[O]),!O||!a)return r.a.createElement("div",null);var w=function(e,t,n,r){var l,i=(l=a,JSON.parse(JSON.stringify(l)));i[n][r]={start:e.toString(),end:t.toString(),duration:18e5,idx:r,day:n},v(function(e){return $.map((function(t){return e[t]||[]})).reduce((function(e,t){return e.concat(t)}),[]).map((function(e){var t=new Date(e.start),a=new Date(e.end);if(t>a)throw new Error("Invalid time range");for(var n=[];t<a;)n.push({hour:Object(ue.a)(t),minute:Object(de.a)(t),day:e.day,duration:e.duration}),t=Object(se.a)(t,e.duration);return n})).reduce((function(e,t){return e.concat(t)}),[])}(i)),c(i)};return r.a.createElement(zr,null,r.a.createElement(rn,{title:"Settings",subtitle:"Adjust the call hours, facility information, and facility kiosk directory as needed."}),r.a.createElement("div",{style:Object(R.a)({},Ta)},r.a.createElement(Rr.a,{defaultActiveKey:o,onChange:function(e){s(e)}},r.a.createElement(qr,{tab:"General Settings",key:"setting"},r.a.createElement(b.a,{title:"Call Hours",extra:[r.a.createElement(g.a,{type:"primary",onClick:function(e){j(at({newCallSlots:f,oldCallSlots:O.callTimes}))}},"Save Changes")]},r.a.createElement(p.b,{direction:"vertical"},$.map((function(e){return function(e,t){return r.a.createElement(h.a,{style:{width:"100%",margin:16}},r.a.createElement(Va.a,{span:12},r.a.createElement(E.a.Title,{level:5},["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]||"")),r.a.createElement(Va.a,{span:12},r.a.createElement(p.b,{direction:"vertical",style:Na},t.map((function(t){return r.a.createElement(Zr,{minuteStep:30,use12Hours:!0,defaultValue:[Fr()(Object(fe.a)(new Date(t.start),"HH:mm"),"HH:mm"),Fr()(Object(fe.a)(new Date(t.end),"HH:mm"),"HH:mm")],onChange:function(a){a&&a[0]&&a[1]&&w(a[0].toDate(),a[1].toDate(),e,t.idx)},format:"HH:mm"})})),r.a.createElement(Zr,{format:"HH:mm",minuteStep:30,use12Hours:!0,onChange:function(a){a&&a[0]&&a[1]&&w(a[0].toDate(),a[1].toDate(),e,t.length)}}))))}(e,a[e])}))))),r.a.createElement(qr,{tab:"Facility",key:"facility"},r.a.createElement(b.a,{title:"Facility Tree"},r.a.createElement(Vr.a,{treeData:y,defaultExpandAll:!0}))))))},Ur=a(538),_r=a.n(Ur),Gr=a(1240),Jr=f.a.Content,Kr=f.a.Sider;var Yr=Object(m.c)((function(e,t){return{call:Sa(e,parseInt(t.match.params.id))}}))((function(e){var t=e.call,a=e.match,c=Object(n.useState)(a.params.id),l=Object(u.a)(c,1)[0],i=Object(n.useState)(!1),o=Object(u.a)(i,2),s=o[0],d=o[1],h=Object(m.e)((function(e){var t;return null===(t=e.facilities.selected)||void 0===t?void 0:t.name})),b=jt();Object(n.useEffect)((function(){l&&b(Ke(parseInt(l)))}),[l,b]);var E=[{path:"logs",breadcrumbName:"Logs"},{path:"call",breadcrumbName:"Call #".concat(l)}];return t?r.a.createElement(f.a,null,r.a.createElement(Jr,{style:Ta},r.a.createElement(_r.a,{autoplay:!0,muted:!0,controls:!0,width:"100%",url:t.recordingPath||"/recording_demo.mp4"}),r.a.createElement(Ba.a,{ghost:!1,onBack:function(){return window.history.back()},title:"Call #".concat(l),subTitle:h,breadcrumb:{routes:E},extra:[r.a.createElement(g.a,{key:"download",download:!0,target:"_blank",icon:r.a.createElement(Nr.a,null),href:t.recordingPath},"Download"),r.a.createElement(g.a,{key:"info",onClick:function(){return console.log("add connection page")},icon:r.a.createElement(Gr.a,null)},"Connection")]},r.a.createElement(Jn.a,{size:"small",column:3,bordered:!0},r.a.createElement(Jn.a.Item,{label:"Incarcerated Person"},t.inmates.map((function(e){return Ee(e)}))),r.a.createElement(Jn.a.Item,{label:"Inmate ID"},t.inmates.map((function(e){return e.id}))),r.a.createElement(Jn.a.Item,{label:"Visitor"},t.contacts.map((function(e){return Ee(e)}))),r.a.createElement(Jn.a.Item,{label:"Date"},Object(fe.a)(new Date(t.scheduledStart),"HH:mm")),r.a.createElement(Jn.a.Item,{label:"Start Time"},Object(fe.a)(new Date(t.scheduledStart),"HH:mm")),r.a.createElement(Jn.a.Item,{label:"End Time"},Object(fe.a)(new Date(t.scheduledEnd),"HH:mm")),r.a.createElement(Jn.a.Item,{label:"Location"},t.kiosk.name)))),r.a.createElement(Kr,{theme:"light",style:{height:"100vh",maxHeight:"100vh"},width:300,collapsible:!0,collapsed:s,onCollapse:function(e){return d(e)}},!s&&r.a.createElement("div",null,r.a.createElement(Ba.a,{title:"Chat"})," ",r.a.createElement("div",{style:Ta},r.a.createElement(p.b,{direction:"vertical",style:{overflowY:"scroll",display:"flex",flexDirection:"column",height:"100%"}},t.messages.map((function(e){return r.a.createElement(cn,{message:e})}))))))):r.a.createElement("div",null)})),Qr=function(e){var t=e.calls,a=e.accept,n=e.reject,c=e.navigate;return r.a.createElement(On.a,{dataSource:t},r.a.createElement(On.a.Column,{title:"",dataIndex:"inmates",key:"inmateProfilePic",render:function(e){return r.a.createElement(r.a.Fragment,null,e.map((function(e){return r.a.createElement(Xt,{src:e.profileImagePath,fallback:Ee(e),size:64})})))}}),r.a.createElement(On.a.Column,{title:"Incarcerated Person",dataIndex:"inmates",key:"inmateInfo",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.b,{direction:"vertical"},e.map((function(e){return r.a.createElement(wn,{inmate:e,navigate:c})}))))}}),r.a.createElement(On.a.Column,{title:"",dataIndex:"contacts",key:"contactProfilePic",render:function(e){return r.a.createElement(r.a.Fragment,null,e.map((function(e){return r.a.createElement(Xt,{src:e.profileImagePath,fallback:Ee(e),size:64})})))}}),r.a.createElement(On.a.Column,{title:"Contact",dataIndex:"contacts",key:"contactInfo",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.b,{direction:"vertical"},e.map((function(e){return r.a.createElement(jn,{contact:e,navigate:c})}))))}}),r.a.createElement(On.a.Column,{title:"Scheduled Start",dataIndex:"scheduledStart",key:"scheduledStart",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a.Text,null,Object(fe.a)(new Date(e),"MM/dd/y H:mm")))}}),r.a.createElement(On.a.Column,{title:"Scheduled End",dataIndex:"scheduledEnd",key:"scheduledEnd",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a.Text,null,Object(fe.a)(new Date(e),"MM/dd/y H:mm")))}}),r.a.createElement(On.a.Column,{title:"Kiosk",dataIndex:"kioskId",key:"kioskId"}),r.a.createElement(On.a.Column,{title:"",key:"actions",render:function(e,t){return r.a.createElement(p.b,null,r.a.createElement(g.a,{type:"primary",onClick:function(){return a(t)}},"Accept"),r.a.createElement(g.a,{danger:!0,onClick:function(){return n(t)}},"Reject"))}}))},$r=[{path:"/calendar",component:vn,label:"Page"},{path:"/connection-requests",component:Sn,label:"Connection Requests"},{path:"/call-requests",component:function(){var e=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],r=t[1],c=wt(ba),l=wt(fa),i=wt(ua),o=wt(wa);return Object(n.useEffect)((function(){var e=c.filter((function(e){return"pending_approval"===e.status}));r(Te(e,l,i,o))}),[c,i,l,o]),a}(),t=jt(),a=function(e,a){t(Je({id:e.id,status:a}))};return r.a.createElement(f.a.Content,null,r.a.createElement(kn,{title:"Approval Requests",subtitle:"Review all connection requests between incarcerated people in your facility and their loved one on the outside."}),r.a.createElement("div",{style:Ta},r.a.createElement(Qr,{calls:e,accept:function(e){return a(e,"scheduled")},reject:function(e){return a(e,"rejected")},navigate:function(e){return t(Object(gn.d)(e))}})))},label:"Call Requests"},{path:"/logs",component:Hn,label:"Search for Visits"},{path:"/staff",component:Zn,label:"Staff"},{path:"/members",component:Un,label:"Inmates"},{path:"/members/:id",component:tr,label:"Incarcerated Individual"},{path:"/contacts/:id",component:nr,label:"Contact"},{path:"/visitations",component:mn,label:"Live Calls"},{path:"/settings",component:Wr,label:"Settings"},{path:"/call/:id",component:Yr,label:"Past Call"},{path:"/",component:Hr,label:"Dashboard"}],Xr=[{label:"Terminated",key:"terminated",value:"terminated"},{label:"Ended",key:"ended",value:"ended"},{label:"Scheduled",key:"scheduled",value:"scheduled"}],ec=a(539),tc=a.n(ec),ac=function(e){var t=e.call,a=e.cancelCall,c=e.closeModal,l=Object(n.useState)(""),i=Object(u.a)(l,2),o=i[0],s=i[1];return r.a.createElement(Wa.a,{title:"Cancel call ".concat(t.id,"?"),onOk:function(){a(t.id,o),c()},onCancel:c,okText:"Confirm",visible:!0},r.a.createElement(E.a.Text,null," ","Please provide a reason for the cancellation so we can inform"," ",De(t)," and ",Ne(t)),r.a.createElement(tc.a,{rows:3,onChange:function(e){return s(e.target.value)},value:o}))},nc=function(e){var t=jt(),a=wt((function(e){return e.modals.data}));switch(a.activeType){case"CANCEL_CALL_MODAL":return r.a.createElement(ac,{call:a.entity,closeModal:function(){return t(vt())},cancelCall:function(e,a){return t(Je({id:e,status:"cancelled",statusDetails:a}))}});default:return r.a.createElement("div",null)}},rc={logout:function(){return{type:"user/LOGOUT"}},fetchFacilities:tt,selectActiveFacility:et,fetchContacts:qe,fetchStaff:W,fetchInmates:K,fetchConnections:Be,fetchGroups:ut,fetchKiosks:ft,fetchCalls:Ge,setRedirectUrl:function(e){return{type:"user/SET_REDIRECT_URL",payload:e}}},cc=Object(m.c)((function(e){return{session:e.session,selected:e.facilities.selected,pathname:e.router.location.pathname,liveCallsCount:xa(e).length}}),rc),lc=function(){return r.a.createElement("div",{className:"d-flex vh-100 vw-100"},r.a.createElement(na.a,{size:"large",className:"m-auto",tip:"Loading workpace..."}))};var ic=cc((function(e){var t=e.session,a=e.selected,c=e.pathname,l=e.liveCallsCount,i=e.selectActiveFacility,p=e.logout,h=e.fetchFacilities,b=e.fetchContacts,E=e.fetchInmates,v=e.fetchStaff,y=e.fetchConnections,g=e.fetchGroups,O=e.fetchKiosks,j=e.fetchCalls,w=e.setRedirectUrl,C=e.history,k=Object(n.useState)("active"===t.status),S=Object(u.a)(k,2),x=S[0],I=S[1],T=Object(n.useState)(!0),D=Object(u.a)(T,2),N=D[0],M=D[1],P=wt(ca).filter((function(e){return"pending"===e.status})).length,A=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),r=a[0],c=a[1],l=wt(ba);return Object(n.useEffect)((function(){var t=l.filter((function(t){return t.status===e}));c(t.length)}),[l,e]),r}("pending_approval");Object(n.useEffect)((function(){return I("active"===t.status)}),[t.status]);var H={isAuthenticated:x,authenticationPath:"/login"},L=Object(m.e)(ga);return Object(n.useEffect)((function(){x&&h()}),[x,h]),Object(n.useEffect)((function(){x||"/login"===c||w(c)}),[w,x,c]),Object(n.useEffect)((function(){a&&(M(!0),Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.allSettled([b(),v(),E(),y(),O(),g(),j({scheduledStart:{rangeStart:Object(me.a)(new Date).getTime(),rangeEnd:Object(Ar.a)(new Date).getTime()},limit:500})]);case 2:case"end":return e.stop()}}),e)})))().then((function(){return M(!1)})))}),[a,b,v,y,E,g,j,O]),r.a.createElement(ct.a,{history:C},r.a.createElement(f.a,{style:{minHeight:"100vh"}},a&&r.a.createElement(aa,{user:t.user,isLoggedIn:x,logout:p,selected:a,facilities:L,select:function(e){return i(e)},liveCallsCount:l,requestsCount:P,callRequestsCount:A}),r.a.createElement(f.a,null,N&&x||"loading"===t.status?r.a.createElement(lc,null):r.a.createElement(d.d,null,r.a.createElement(d.b,{exact:!0,path:"/login",component:Bt}),$r.map((function(e){return r.a.createElement(Ft,Object.assign({exact:!0},H,{path:e.path,component:e.component,key:e.label}))}))))),r.a.createElement(nc,null))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(m.a,{store:Ot},r.a.createElement(ic,{history:yt}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},278:function(e,t,a){},553:function(e,t,a){e.exports=a(1191)},558:function(e,t,a){},563:function(e,t,a){},699:function(e,t,a){},768:function(e,t,a){},885:function(e,t){},887:function(e,t){},917:function(e,t){},918:function(e,t){}},[[553,1,2]]]);
//# sourceMappingURL=main.1225cb13.chunk.js.map